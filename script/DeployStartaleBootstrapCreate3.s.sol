// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.29;

import '../src/deployer/Deployer.sol';
import {Script, console} from 'forge-std/Script.sol';

contract DeployStartaleBootstrapCreate3 is Script {
  Deployer deployerInstance;
  address entryPoint;
  mapping(uint256 => uint256) public DEPLOYMENT_CHAIN_GAS_PRICES;
  address public constant eEeEeAddress = address(0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE);

  error NoGasPriceSet();
  error ContractDeploymentFailed();

  function setUp() public {
    deployerInstance = Deployer(vm.envAddress('DEPLOYER_CONTRACT_ADDRESS')); // Set Deployer contract
    // EntryPoint v0.7 address
    entryPoint = vm.parseAddress('0x0000000071727De22E5E9d8BAf0edAc6f37da032');
    DEPLOYMENT_CHAIN_GAS_PRICES[1946] = 0.002 gwei;
    DEPLOYMENT_CHAIN_GAS_PRICES[1868] = 0.001 gwei;
  }

  function run() public {
    uint256 deployerPrivateKey = vm.envUint('PRIVATE_KEY');

    string memory contractName = 'Bootstrap';
    string memory saltString = vm.envString('STARTALE_SMART_ACCOUNT_BOOTSTRAP_SALT');

    bytes memory deployedBytecode =
      hex'610140806040523461024657612e92803803809161001d82856102b2565b8339810190604081830312610246578051906001600160a01b03821690818303610246576020810151906001600160401b038211610246570183601f820112156102465780516001600160401b03811161029e5760405191610089601f8301601f1916602001846102b2565b81835260208301956020838301011161024657815f926020809301885e83010152306080524660a05260409360a085516100c387826102b2565b6018815260208101907f5374617274616c654163636f756e74426f6f747374726170000000000000000082528751916100fc89846102b2565b600583526020830191640312e302e360dc1b8352519020915190208160c0528060e0528751917f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f83526020830152878201524660608201523060808201522061010052845163ecd0596160e01b815260016004820152602081602481875afa908115610294575f91610259575b501561024a57823b15610246576044925f928387519586809581946306d61fe760e41b8352602060048401525180918160248501528484015e8181018301849052601f01601f191681010301925af1801561023c5761022c575b506101205251612bbc90816102d6823960805181505060a05181505060c05181505060e0518150506101005181505061012051818181610acf0152818161126d01526117020152f35b5f610236916102b2565b5f6101e3565b83513d5f823e3d90fd5b5f80fd5b631c4f83bb60e31b5f5260045ffd5b90506020813d60201161028c575b81610274602093836102b2565b8101031261024657518015158103610246575f610189565b3d9150610267565b86513d5f823e3d90fd5b634e487b7160e01b5f52604160045260245ffd5b601f909101601f19168101906001600160401b0382119082101761029e5760405256fe60806040526004361015610015575b36610cc157005b5f3560e01c80630984b2f7146100df5780630a664dba146100da578063112d3a7d146100d55780632a63da5a146100d0578063481ddd23146100cb5780635888596b146100c65780635faac46b146100c157806384b0196e146100bc5780639517e29f146100ad5780639f3ed4d9146100b7578063a6034278146100b2578063a71763a8146100ad5763ea5f61d00361000e57610b3f565b61091c565b610a98565b610925565b610800565b610619565b6104e0565b610422565b6102c8565b6102ac565b6101f2565b610127565b9181601f840112156101155782359167ffffffffffffffff8311610115576020808501948460051b01011161011557565b5f80fd5b908160409103126101155790565b60a03660031901126101155760043567ffffffffffffffff8111610115576101539036906004016100e4565b60243567ffffffffffffffff8111610115576101739036906004016100e4565b60449391933567ffffffffffffffff811161011557610196903690600401610119565b9060643567ffffffffffffffff8111610115576101b79036906004016100e4565b9290916084359667ffffffffffffffff8811610115576101de6101e69836906004016100e4565b979096610f1f565b005b5f91031261011557565b34610115575f3660031901126101155760206001600160a01b035f516020612b7c5f395f51905f5254166001600160a01b0360405191168152f35b6001600160a01b0381160361011557565b9181601f840112156101155782359167ffffffffffffffff8311610115576020838186019501011161011557565b606060031982011261011557600435916024356102888161022d565b916044359067ffffffffffffffff8211610115576102a89160040161023e565b9091565b34610115576102ba3661026c565b5050505060206040515f8152f35b60403660031901126101155760043567ffffffffffffffff8111610115576102f49036906004016100e4565b9060243567ffffffffffffffff811161011557610315903690600401610119565b9161031e6125c3565b61032661265e565b5f5b8181106103a757836001600160a01b03610341826111f0565b1661034857005b6103a26103818261037c6103695f516020612b3c5f395f51905f52956111f0565b61037660208401846111fa565b91612216565b6111f0565b60408051600481526001600160a01b03909216602083015290918291820190565b0390a1005b806103d96103bb61037c60019486886111c9565b6103d36103c98487896111c9565b60208101906111fa565b916115be565b5f516020612b3c5f395f51905f526104196103f861037c8487896111c9565b60408051600181526001600160a01b03909216602083015290918291820190565b0390a101610328565b34610115576020366003190112610115576004356001600160e01b03198116810361011557610482906001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b60405190604082019082821067ffffffffffffffff8311176104db576040918252546001600160a01b03811680845260589190911b6001600160f81b0319166020938401819052825190815292830152819081015b0390f35b610c3b565b60c03660031901126101155760043567ffffffffffffffff81116101155761050c90369060040161023e565b60243567ffffffffffffffff81116101155761052c9036906004016100e4565b60449391933567ffffffffffffffff81116101155761054f9036906004016100e4565b60649291923567ffffffffffffffff811161011557610572903690600401610119565b9060843567ffffffffffffffff8111610115576105939036906004016100e4565b94909360a4359867ffffffffffffffff8a11610115576105ba6101e69a36906004016100e4565b99909861124f565b90929192604082016040835281518091526020606084019201905f5b8181106105fa575050506001600160a01b036020919416910152565b82516001600160a01b03168452602093840193909201916001016105de565b34610115576040366003190112610115576004356106368161022d565b6024359060016001600160a01b0382161415806107c6575b6107ab57811561078357906106628161251b565b61069a61068d5f946001600160a01b03165f525f516020612b5c5f395f51905f5260205260405f2090565b546001600160a01b031690565b6001600160a01b0381168015159081610777575b508061076e575b1561070f5761070361068d826106e0610709946106d2898861254d565b906001600160a01b03169052565b6001600160a01b03165f525f516020612b5c5f395f51905f5260205260405f2090565b93612575565b9261069a565b908360016001600160a01b038416141580610765575b61073b575b81526104d7604051928392836105c2565b915061075f61075261074c84612588565b8361254d565b516001600160a01b031690565b9161072a565b50801515610725565b508284106106b5565b6001915014155f6106ae565b7ff7250817000000000000000000000000000000000000000000000000000000005f5260045ffd5b637c84ecfb60e01b5f526001600160a01b031660045260245ffd5b506107d76107d382612abb565b1590565b61064e565b805180835260209291819084018484015e5f828201840152601f01601f1916010190565b34610115575f366003190112610115576108be60406108cb8151916108258184610c4f565b601883527f5374617274616c654163636f756e74426f6f74737472617000000000000000006020840152805161085b8282610c4f565b600581527f312e302e30000000000000000000000000000000000000000000000000000000602082015281519485947f0f00000000000000000000000000000000000000000000000000000000000000865260e0602087015260e08601906107dc565b91848303908501526107dc565b4660608301523060808301525f60a083015281810360c083015260206060519182815201906080905f5b818110610903575050500390f35b82518452859450602093840193909201916001016108f5565b6101e63661026c565b60403660031901126101155760043561093d8161022d565b60243567ffffffffffffffff81116101155761095d90369060040161023e565b6109689291926125c3565b61097061265e565b6001600160a01b036109966001600160a01b035f516020612b7c5f395f51905f52541690565b16806109ba5750906103f86103a2925f516020612b3c5f395f51905f5294836116ba565b906040519363d68f602560e01b85525f85806109db36343360048501611558565b038183875af1948515610a69575f95610a6e575b50906109fb91846116ba565b803b1561011557610a265f93918492604051958680948193630b9dfbed60e11b8352600483016115ad565b03925af1908115610a69575f516020612b3c5f395f51905f52926103a292610a4f575b506103f8565b80610a5d5f610a6393610c4f565b806101e8565b5f610a49565b610cb6565b6109fb92919550610a90903d805f833e610a888183610c4f565b8101906114f5565b9490916109ef565b5f60203660031901126101155760043567ffffffffffffffff811161011557610ac590369060040161023e565b6001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001691823b1561011557610b21925f92836040518096819582946306d61fe760e41b84526020600485018181520191610c82565b03925af18015610a6957610b33575080f35b6101e691505f90610c4f565b3461011557604036600319011261011557600435610b5c8161022d565b6024359060016001600160a01b038216141580610c29575b6107ab5781156107835790610b888161251b565b610bb361068d5f946001600160a01b03165f525f516020612b9c5f395f51905f5260205260405f2090565b6001600160a01b0381168015159081610c1d575b5080610c14575b1561070f5761070361068d82610beb610c0e946106d2898861254d565b6001600160a01b03165f525f516020612b9c5f395f51905f5260205260405f2090565b92610bb3565b50828410610bce565b6001915014155f610bc7565b50610c366107d382612afb565b610b74565b634e487b7160e01b5f52604160045260245ffd5b90601f8019910116810190811067ffffffffffffffff8211176104db57604052565b60405190610c80604083610c4f565b565b908060209392818452848401375f828201840152601f01601f1916010190565b916020610cb3938181520191610c82565b90565b6040513d5f823e3d90fd5b5f356001600160e01b0319811690610d0a826001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b54610d296001600160a01b0382169160581b6001600160f81b03191690565b906001600160a01b038116610d9457505060e01c63150b7a0263bc197c81821463f23a6e61831417911417610d8d577f08c63e27000000000000000000000000000000000000000000000000000000005f526001600160e01b03191660045260245ffd5b5f5260205ff35b5f516020612b7c5f395f51905f52546001600160a01b0316801515926060929084610ec9575b6001600160f81b03198116607f60f91b03610e5e57505f8091610ddb612596565b90602082519201905afa92610dee61157e565b935b15610e5657610e02575b825160208401f35b803b1561011557610e2d5f92918392604051948580948193630b9dfbed60e11b8352600483016115ad565b03925af18015610a6957610e42575b80610dfa565b80610a5d5f610e5093610c4f565b81610e3c565b835160208501fd5b6001600160f81b03198116610e9457505f8091610e79612596565b906020825192019034905af192610e8e61157e565b93610df0565b7fb96fcfe4000000000000000000000000000000000000000000000000000000005f526001600160f81b03191660045260245ffd5b925060405163d68f602560e01b81525f8180610eea36343360048501611558565b038183875af1908115610a69575f91610f05575b5092610dba565b610f1991503d805f833e610a888183610c4f565b85610efe565b9095949395610f2c6125c3565b610f3461265e565b5f5b818110611179575050505f5b8281106110ec575050505f5b82811061105f57505050610f70610f64826111f0565b6001600160a01b031690565b611035575b505f5b828110610f8457505050565b80610fa0610f646020610f9a600195888861122d565b016111f0565b1561103057610fe5610fb382868661122d565b35610fc46020610f9a85898961122d565b90610fdd610fd385898961122d565b60408101906111fa565b9290916123b2565b5f516020612b3c5f395f51905f52610ffe82868661122d565b3561100f6020610f9a85898961122d565b604080519283526001600160a01b0391909116602083015290a15b01610f78565b61102a565b6110566103818261037c6103695f516020612b3c5f395f51905f52956111f0565b0390a15f610f75565b80611073610f6461037c60019487876111c9565b156110e75761109d61108961037c8387876111c9565b6110976103c98488886111c9565b916118e4565b5f516020612b3c5f395f51905f526110dd6110bc61037c8488886111c9565b60408051600381526001600160a01b03909216602083015290918291820190565b0390a15b01610f4e565b6110e1565b80611100610f6461037c60019487876111c9565b156111745761112a61111661037c8387876111c9565b6111246103c98488886111c9565b916117e4565b5f516020612b3c5f395f51905f5261116a61114961037c8488886111c9565b60408051600281526001600160a01b03909216602083015290918291820190565b0390a15b01610f42565b61116e565b8061118d6103bb61037c60019486886111c9565b5f516020612b3c5f395f51905f526111ac6103f861037c8487896111c9565b0390a101610f36565b634e487b7160e01b5f52603260045260245ffd5b91908110156111eb5760051b81013590603e1981360301821215610115570190565b6111b5565b35610cb38161022d565b903590601e1981360301821215610115570180359067ffffffffffffffff82116101155760200191813603831361011557565b91908110156111eb5760051b81013590605e1981360301821215610115570190565b9796959761125b6125c3565b61126361265e565b6001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001691823b15610115576112b8925f92836040518096819582946306d61fe760e41b845260048401610ca2565b03925af18015610a69576114c5575b505f5b82811061145f575050505f5b828110611407575050505f5b8281106113af575050506112f8610f64826111f0565b611385575b505f5b82811061130c57505050565b80611322610f646020610f9a600195888861122d565b1561138057611335610fb382868661122d565b5f516020612b3c5f395f51905f5261134e82868661122d565b3561135f6020610f9a85898961122d565b604080519283526001600160a01b0391909116602083015290a15b01611300565b61137a565b6113a66103818261037c6103695f516020612b3c5f395f51905f52956111f0565b0390a15f6112fd565b806113c3610f6461037c60019487876111c9565b15611402576113d961108961037c8387876111c9565b5f516020612b3c5f395f51905f526113f86110bc61037c8488886111c9565b0390a15b016112e2565b6113fc565b8061141b610f6461037c60019487876111c9565b1561145a5761143161111661037c8387876111c9565b5f516020612b3c5f395f51905f5261145061114961037c8488886111c9565b0390a15b016112d6565b611454565b80611473610f6461037c60019487876111c9565b156114c05761149761148961037c8387876111c9565b6103d36103c98488886111c9565b5f516020612b3c5f395f51905f526114b66103f861037c8488886111c9565b0390a15b016112ca565b6114ba565b80610a5d5f6114d393610c4f565b5f6112c7565b67ffffffffffffffff81116104db57601f01601f191660200190565b6020818303126101155780519067ffffffffffffffff8211610115570181601f8201121561011557805190611529826114d9565b926115376040519485610c4f565b8284526020838301011161011557815f9260208093018386015e8301015290565b610cb393926001600160a01b03606093168252602082015281604082015201905f610c82565b3d156115a8573d9061158f826114d9565b9161159d6040519384610c4f565b82523d5f602084013e565b606090565b906020610cb39281815201906107dc565b91906001600160a01b036115e66001600160a01b035f516020612b7c5f395f51905f52541690565b16806115f65750610c80926116ba565b90916040519263d68f602560e01b84525f848061161836343360048501611558565b038183875af1938415610a69575f94611682575b506116389293946116ba565b803b15610115576116635f92918392604051948580948193630b9dfbed60e11b8352600483016115ad565b03925af18015610a69576116745750565b80610a5d5f610c8093610c4f565b61163893945061169b903d805f833e610a888183610c4f565b939261162c565b90816020910312610115575180151581036101155790565b60405163ecd0596160e01b8152600160048201526001600160a01b038216939190602081602481885afa908115610a69575f916117b5575b501561178d576001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016841461176557611731906126d1565b8061173b57505050565b823b1561011557611663925f92836040518096819582946306d61fe760e41b845260048401610ca2565b7fabc3af79000000000000000000000000000000000000000000000000000000005f5260045ffd5b7fe27c1dd8000000000000000000000000000000000000000000000000000000005f5260045ffd5b6117d7915060203d6020116117dd575b6117cf8183610c4f565b8101906116a2565b5f6116f2565b503d6117c5565b91906001600160a01b0361180c6001600160a01b035f516020612b7c5f395f51905f52541690565b168061181c5750610c809261187e565b90916040519263d68f602560e01b84525f848061183e36343360048501611558565b038183875af1938415610a69575f9461185e575b5061163892939461187e565b611638939450611877903d805f833e610a888183610c4f565b9392611852565b60405163ecd0596160e01b8152600260048201526001600160a01b038216939190602081602481885afa908115610a69575f916118c5575b501561178d5761173190612822565b6118de915060203d6020116117dd576117cf8183610c4f565b5f6118b6565b91906001600160a01b0361190c6001600160a01b035f516020612b7c5f395f51905f52541690565b168061191c5750610c8092611b6c565b90916040519263d68f602560e01b84525f848061193e36343360048501611558565b038183875af1938415610a69575f9461195e575b50611638929394611b6c565b611638939450611977903d805f833e610a888183610c4f565b9392611952565b906004116101155790600490565b909291928360051161011557831161011557600501916004190190565b919091356001600160e01b0319811692600481106119c5575050565b6001600160e01b0319929350829060040360031b1b161690565b90600410156111eb5760040190565b156119f557565b7f867a1dcf000000000000000000000000000000000000000000000000000000005f5260045ffd5b929192611a29826114d9565b91611a376040519384610c4f565b829481845281830111610115578281602093845f960137010152565b15611a5a57565b7fc001660b000000000000000000000000000000000000000000000000000000005f5260045ffd5b15611a8a5750565b6001600160e01b0319907fa56a04dd000000000000000000000000000000000000000000000000000000005f521660045260245ffd5b7f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c035490680100000000000000008210156104db5760018201807f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c03558210156111eb577f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c035f5260205f208260031c019163ffffffff60e084549260051b169260e01c831b921b1916179055565b90916001600160a01b0382169160405163ecd0596160e01b815260208180611b9c60048201906003602083019252565b0381875afa908115610a69575f916121f7575b501561178d57611de78491611d4d611c2f611c288680611c06611bf9611beb83611be5611bdf611dec9e8e61197e565b906119a9565b9b6119df565b356001600160f81b03191690565b6001600160f81b03191690565b9a6001600160f81b03198c161580156121e0575b611c23906119ee565b61198c565b3691611a1d565b96611d0d6001600160e01b031986166306d61fe760e41b81149081156121b6575b81156121a5575b811561217b575b8115612151575b8115612127575b8115612116575b8115612105575b81156120f4575b81156120e3575b81156120d2575b81156120c1575b8115612097575b811561206d575b8115612043575b8115612019575b8115611fef575b8115611fc5575b8115611f9b575b8115611f71575b8115611f47575b8115611f1d575b8115611ef3575b8115611ec9575b8115611e9f575b8115611e75575b8115611e4b575b8115611e21575b5015611a53565b611d2285611d1d6107d382612912565b611a82565b611d3c611d2d610c71565b6001600160a01b039094168452565b6001600160f81b0319166020830152565b611d88836001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b8151815460209093015174ff000000000000000000000000000000000000000060589190911c167fffffffffffffffffffffff0000000000000000000000000000000000000000009093166001600160a01b0390911617919091179055565b611ac0565b8151611df6575050565b803b15610115576116635f929183926040519485809481936306d61fe760e41b8352600483016115ad565b7f112d3a7d000000000000000000000000000000000000000000000000000000009150145f611d06565b7fa71763a80000000000000000000000000000000000000000000000000000000081149150611cff565b7f9517e29f0000000000000000000000000000000000000000000000000000000081149150611cf8565b7fd691c9640000000000000000000000000000000000000000000000000000000081149150611cf1565b7fe9ae5c530000000000000000000000000000000000000000000000000000000081149150611cea565b7f9cfd7cff0000000000000000000000000000000000000000000000000000000081149150611ce3565b7fd03c79140000000000000000000000000000000000000000000000000000000081149150611cdc565b7ff2dc691d0000000000000000000000000000000000000000000000000000000081149150611cd5565b7f4b6a14190000000000000000000000000000000000000000000000000000000081149150611cce565b7f1626ba7e0000000000000000000000000000000000000000000000000000000081149150611cc7565b7f8dd7712f0000000000000000000000000000000000000000000000000000000081149150611cc0565b7fb760faf90000000000000000000000000000000000000000000000000000000081149150611cb9565b7f52b7512c0000000000000000000000000000000000000000000000000000000081149150611cb2565b7f19822f7c0000000000000000000000000000000000000000000000000000000081149150611cab565b7f570e1a360000000000000000000000000000000000000000000000000000000081149150611ca4565b7fee2194230000000000000000000000000000000000000000000000000000000081149150611c9d565b637aa8f17760e11b81149150611c96565b639700320360e01b81149150611c8f565b630b9dfbed60e11b81149150611c88565b63d68f602560e01b81149150611c81565b637aa8f17760e11b81149150611c7a565b639700320360e01b81149150611c73565b7fe24f8f930000000000000000000000000000000000000000000000000000000081149150611c6c565b7f7a0468b70000000000000000000000000000000000000000000000000000000081149150611c65565b7fd60b347f0000000000000000000000000000000000000000000000000000000081149150611c5e565b63ecd0596160e01b81149150611c57565b7f8a91b0e30000000000000000000000000000000000000000000000000000000081149150611c50565b50607f60f91b6001600160f81b03198d1614611c1a565b612210915060203d6020116117dd576117cf8183610c4f565b5f611baf565b91906001600160a01b0361223e6001600160a01b035f516020612b7c5f395f51905f52541690565b168061224e5750610c80926122ed565b90916040519263d68f602560e01b84525f848061227036343360048501611558565b038183875af1938415610a69575f94612290575b506116389293946122ed565b6116389394506122a9903d805f833e610a888183610c4f565b9392612284565b156122b85750565b6001600160a01b03907f741cbe03000000000000000000000000000000000000000000000000000000005f521660045260245ffd5b60405163ecd0596160e01b81526004808201526001600160a01b038216939190602081602481885afa908115610a69575f91612393575b501561178d576117319061235f61234f6001600160a01b035f516020612b7c5f395f51905f52541690565b6001600160a01b038116156122b0565b6001600160a01b03166001600160a01b03195f516020612b7c5f395f51905f525416175f516020612b7c5f395f51905f5255565b6123ac915060203d6020116117dd576117cf8183610c4f565b5f612324565b9291906001600160a01b036123db6001600160a01b035f516020612b7c5f395f51905f52541690565b16806123eb5750610c809361244f565b916040939193519363d68f602560e01b85525f858061240f36343360048501611558565b038183885af1948515610a69575f9561242f575b5061163893949561244f565b611638949550612448903d805f833e610a888183610c4f565b9493612423565b60405163ecd0596160e01b8152600481018290526001600160a01b03831694929190602081602481895afa908115610a69575f916124e4575b501561178d576124978161295c565b6001600160a01b0381166124b0575090611731916129f5565b7fc689cd97000000000000000000000000000000000000000000000000000000005f526001600160a01b031660045260245ffd5b6124fd915060203d6020116117dd576117cf8183610c4f565b5f612488565b67ffffffffffffffff81116104db5760051b60200190565b9061252582612503565b6125326040519182610c4f565b8281528092612543601f1991612503565b0190602036910137565b80518210156111eb5760209160051b010190565b634e487b7160e01b5f52601160045260245ffd5b5f1981146125835760010190565b612561565b5f1981019190821161258357565b60405190602036830101604052816014360181525f602036920137604051601481016040523360601b9052565b60015f525f516020612b9c5f395f51905f526020527fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f5546001600160a01b03166126365760015f525f516020612b9c5f395f51905f52602052610c8060405f2060016001600160a01b0319825416179055565b7f53c85e66000000000000000000000000000000000000000000000000000000005f5260045ffd5b60015f525f516020612b5c5f395f51905f526020527f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf17546001600160a01b03166126365760015f525f516020612b5c5f395f51905f52602052610c8060405f2060016001600160a01b0319825416179055565b6001600160a01b03811680158015612818575b612806575f9081525f516020612b5c5f395f51905f5260205260409020546001600160a01b03166127d25760015f525f516020612b5c5f395f51905f52602052610c80906127976127547f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf1761068d565b61277c835f516020612b5c5f395f51905f52906001600160a01b03165f5260205260405f2090565b906001600160a01b03166001600160a01b0319825416179055565b60015f525f516020612b5c5f395f51905f526020527f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf1761277c565b7f40d3d1a4000000000000000000000000000000000000000000000000000000005f526001600160a01b031660045260245ffd5b637c84ecfb60e01b5f5260045260245ffd5b50600181146126e4565b6001600160a01b03811680158015612908575b612806575f9081525f516020612b9c5f395f51905f5260205260409020546001600160a01b03166127d25760015f525f516020612b9c5f395f51905f52602052610c80906128cd6128a57fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f561068d565b61277c835f516020612b9c5f395f51905f52906001600160a01b03165f5260205260405f2090565b60015f525f516020612b9c5f395f51905f526020527fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f561277c565b5060018114612835565b6129556001600160a01b03916001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b5416151590565b6008810361299357506001600160a01b037f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c09541690565b600981036129ca57506001600160a01b037f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c08541690565b7ff6424610000000000000000000000000000000000000000000000000000000005f5260045260245ffd5b60088103612a5857506001600160a01b03166001600160a01b03197f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c095416177f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0955565b600981036129ca57506001600160a01b03166001600160a01b03197f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c085416177f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0855565b6001600160a01b031680600114159081612ad3575090565b90505f525f516020612b5c5f395f51905f526020526001600160a01b0360405f205416151590565b6001600160a01b031680600114159081612b13575090565b90505f525f516020612b9c5f395f51905f526020526001600160a01b0360405f20541615159056fed21d0b289f126c4b473ea641963e766833c2f13866e4ff480abd787c100ef1239195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c009195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c069195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c01';

    // Load environment variables
    address defaultECDSAValidator = vm.envAddress('DEFAULT_ECDSA_VALIDATOR');
    bytes memory initData = abi.encodePacked(eEeEeAddress);

    bytes memory constructorArgs = abi.encode(defaultECDSAValidator, initData);

    // Concatenate bytecode + constructor arguments
    bytes memory finalBytecode = abi.encodePacked(deployedBytecode, constructorArgs);

    // Deploy contract if needed
    deployGeneric(deployerPrivateKey, saltString, finalBytecode, contractName);
  }

  function deployGeneric(
    uint256 deployerPrivateKey,
    string memory saltString,
    bytes memory finalBytecode,
    string memory contractName
  ) public {
    // Compute derived salt
    bytes32 derivedSalt = keccak256(abi.encodePacked(saltString));

    // Compute contract address before deployment
    address computedAddress = deployerInstance.addressOf(derivedSalt);

    console.log(string(abi.encodePacked(contractName, ' Computed Address:')), computedAddress);

    // Check if contract is already deployed
    uint256 codeSize;
    assembly {
      codeSize := extcodesize(computedAddress)
    }

    if (codeSize == 0) {
      console.log(string(abi.encodePacked(contractName, ' not deployed, deploying now...')));
      deployContract(deployerPrivateKey, derivedSalt, finalBytecode, contractName, computedAddress);
    } else {
      console.log(string(abi.encodePacked(contractName, ' already deployed at:')), computedAddress);
    }
  }

  function deployContract(
    uint256 deployerPrivateKey,
    bytes32 derivedSalt,
    bytes memory finalBytecode,
    string memory contractName,
    address computedAddress
  ) internal {
    uint256 chainId = block.chainid;

    uint256 gasPrice = DEPLOYMENT_CHAIN_GAS_PRICES[chainId];
    require(gasPrice > 0, NoGasPriceSet());

    console.log('Using gas price:', gasPrice);

    // Deploy contract using deployer's private key
    vm.startBroadcast(deployerPrivateKey);
    (bool success,) = address(deployerInstance).call{gas: 5_000_000}(
      abi.encodeWithSignature('deploy(bytes32,bytes)', derivedSalt, finalBytecode)
    );
    vm.stopBroadcast();

    require(success, ContractDeploymentFailed());

    console.log(string(abi.encodePacked('Transaction success: ', contractName)));

    // Verify deployment by checking contract existence
    uint256 codeSize;
    assembly {
      codeSize := extcodesize(computedAddress)
    }

    if (codeSize == 0) {
      console.log(string(abi.encodePacked('Invalid deployment of ', contractName)));
    } else {
      console.log(string(abi.encodePacked(contractName, ' Deployed Successfully at:')), computedAddress);
    }
  }
}
