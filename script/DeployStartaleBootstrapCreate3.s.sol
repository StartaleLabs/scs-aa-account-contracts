// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.30;

import '../src/deployer/Deployer.sol';
import {Script, console} from 'forge-std/Script.sol';

contract DeployStartaleBootstrapCreate3 is Script {
  Deployer deployerInstance;
  address entryPoint;
  mapping(uint256 => uint256) public DEPLOYMENT_CHAIN_GAS_PRICES;
  address public constant eEeEeAddress = address(0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE);

  error NoGasPriceSet();
  error ContractDeploymentFailed();

  function setUp() public {
    deployerInstance = Deployer(vm.envAddress('DEPLOYER_CONTRACT_ADDRESS')); // Set Deployer contract
    // EntryPoint v0.7 address
    entryPoint = vm.parseAddress('0x0000000071727De22E5E9d8BAf0edAc6f37da032');
    DEPLOYMENT_CHAIN_GAS_PRICES[1946] = 0.002 gwei;
    DEPLOYMENT_CHAIN_GAS_PRICES[1868] = 0.001 gwei;
  }

  function run() public {
    uint256 deployerPrivateKey = vm.envUint('PRIVATE_KEY');

    string memory contractName = 'Bootstrap';
    string memory saltString = vm.envString('STARTALE_SMART_ACCOUNT_BOOTSTRAP_SALT');

    bytes memory deployedBytecode =
      hex'610140806040523461024657612ae3803803809161001d82856102b2565b8339810190604081830312610246578051906001600160a01b03821690818303610246576020810151906001600160401b038211610246570183601f820112156102465780516001600160401b03811161029e5760405191610089601f8301601f1916602001846102b2565b81835260208301956020838301011161024657815f926020809301885e83010152306080524660a05260409360a085516100c387826102b2565b6018815260208101907f5374617274616c654163636f756e74426f6f747374726170000000000000000082528751916100fc89846102b2565b600583526020830191640312e302e360dc1b8352519020915190208160c0528060e0528751917f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f83526020830152878201524660608201523060808201522061010052845163ecd0596160e01b815260016004820152602081602481875afa908115610294575f91610259575b501561024a57823b15610246576044925f928387519586809581946306d61fe760e41b8352602060048401525180918160248501528484015e8181018301849052601f01601f191681010301925af1801561023c5761022c575b50610120525161280d90816102d6823960805181505060a05181505060c05181505060e0518150506101005181505061012051818181610a7e015281816111dd01526116730152f35b5f610236916102b2565b5f6101e3565b83513d5f823e3d90fd5b5f80fd5b631c4f83bb60e31b5f5260045ffd5b90506020813d60201161028c575b81610274602093836102b2565b8101031261024657518015158103610246575f610189565b3d9150610267565b86513d5f823e3d90fd5b634e487b7160e01b5f52604160045260245ffd5b601f909101601f19168101906001600160401b0382119082101761029e5760405256fe60806040526004361015610015575b36610c7057005b5f3560e01c80630984b2f7146100df5780630a664dba146100da578063112d3a7d146100d55780632a63da5a146100d0578063481ddd23146100cb5780635888596b146100c65780635faac46b146100c157806384b0196e146100bc5780639517e29f146100ad5780639f3ed4d9146100b7578063a6034278146100b2578063a71763a8146100ad5763ea5f61d00361000e57610aee565b6108ca565b610a47565b6108d3565b6107e2565b610614565b6104db565b610422565b6102c8565b6102ac565b6101f2565b610127565b9181601f840112156101155782359167ffffffffffffffff8311610115576020808501948460051b01011161011557565b5f80fd5b908160409103126101155790565b60a03660031901126101155760043567ffffffffffffffff8111610115576101539036906004016100e4565b60243567ffffffffffffffff8111610115576101739036906004016100e4565b60449391933567ffffffffffffffff811161011557610196903690600401610119565b9060643567ffffffffffffffff8111610115576101b79036906004016100e4565b9290916084359667ffffffffffffffff8811610115576101de6101e69836906004016100e4565b979096610e8f565b005b5f91031261011557565b34610115575f3660031901126101155760206001600160a01b035f5160206127cd5f395f51905f5254166001600160a01b0360405191168152f35b6001600160a01b0381160361011557565b9181601f840112156101155782359167ffffffffffffffff8311610115576020838186019501011161011557565b606060031982011261011557600435916024356102888161022d565b916044359067ffffffffffffffff8211610115576102a89160040161023e565b9091565b34610115576102ba3661026c565b5050505060206040515f8152f35b60403660031901126101155760043567ffffffffffffffff8111610115576102f49036906004016100e4565b9060243567ffffffffffffffff811161011557610315903690600401610119565b9161031e6122a9565b61032661232b565b5f5b8181106103a757836001600160a01b0361034182611160565b1661034857005b6103a26103818261037c6103695f51602061278d5f395f51905f5295611160565b610376602084018461116a565b91611f2e565b611160565b60408051600481526001600160a01b03909216602083015290918291820190565b0390a1005b806103d96103bb61037c6001948688611139565b6103d36103c9848789611139565b602081019061116a565b9161152e565b5f51602061278d5f395f51905f526104196103f861037c848789611139565b60408051600181526001600160a01b03909216602083015290918291820190565b0390a101610328565b34610115576020366003190112610115576004356001600160e01b031981168103610115576001600160e01b0319165f9081527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c026020526040902060405190604082019082821067ffffffffffffffff8311176104d6576040918252546001600160a01b03811680845260589190911b6001600160f81b0319166020938401819052825190815292830152819081015b0390f35b610bea565b60c03660031901126101155760043567ffffffffffffffff81116101155761050790369060040161023e565b60243567ffffffffffffffff8111610115576105279036906004016100e4565b60449391933567ffffffffffffffff81116101155761054a9036906004016100e4565b60649291923567ffffffffffffffff81116101155761056d903690600401610119565b9060843567ffffffffffffffff81116101155761058e9036906004016100e4565b94909360a4359867ffffffffffffffff8a11610115576105b56101e69a36906004016100e4565b9990986111bf565b90929192604082016040835281518091526020606084019201905f5b8181106105f5575050506001600160a01b036020919416910152565b82516001600160a01b03168452602093840193909201916001016105d9565b34610115576040366003190112610115576004356106318161022d565b6024359060016001600160a01b0382161415806107a8575b61078d57811561077e579061065d81612201565b6106956106885f946001600160a01b03165f525f5160206127ad5f395f51905f5260205260405f2090565b546001600160a01b031690565b6001600160a01b0381168015159081610772575b5080610769575b1561070a576106fe610688826106db610704946106cd8988612233565b906001600160a01b03169052565b6001600160a01b03165f525f5160206127ad5f395f51905f5260205260405f2090565b9361225b565b92610695565b908360016001600160a01b038416141580610760575b610736575b81526104d2604051928392836105bd565b915061075a61074d6107478461226e565b83612233565b516001600160a01b031690565b91610725565b50801515610720565b508284106106b0565b6001915014155f6106a9565b63f725081760e01b5f5260045ffd5b637c84ecfb60e01b5f526001600160a01b031660045260245ffd5b506107b96107b58261270c565b1590565b610649565b805180835260209291819084018484015e5f828201840152601f01601f1916010190565b34610115575f3660031901126101155761086c60406108798151916108078184610bfe565b601883527f5374617274616c654163636f756e74426f6f74737472617000000000000000006020840152805161083d8282610bfe565b60058152640312e302e360dc1b60208201528151948594600f60f81b865260e0602087015260e08601906107be565b91848303908501526107be565b4660608301523060808301525f60a083015281810360c083015260206060519182815201906080905f5b8181106108b1575050500390f35b82518452859450602093840193909201916001016108a3565b6101e63661026c565b6040366003190112610115576004356108eb8161022d565b60243567ffffffffffffffff81116101155761090b90369060040161023e565b6109169291926122a9565b61091e61232b565b6001600160a01b036109446001600160a01b035f5160206127cd5f395f51905f52541690565b16806109685750906103f86103a2925f51602061278d5f395f51905f52948361162b565b906040519363d68f602560e01b85525f8580610989363433600485016114c8565b038183875af1948515610a18575f95610a1d575b50906109a9918461162b565b803b1561011557604051630b9dfbed60e11b8152925f9184918290849082906109d5906004830161151d565b03925af1908115610a18575f51602061278d5f395f51905f52926103a2926109fe575b506103f8565b80610a0c5f610a1293610bfe565b806101e8565b5f6109f8565b610c65565b6109a992919550610a3f903d805f833e610a378183610bfe565b810190611465565b94909161099d565b5f60203660031901126101155760043567ffffffffffffffff811161011557610a7490369060040161023e565b6001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001691823b1561011557610ad0925f92836040518096819582946306d61fe760e41b84526020600485018181520191610c31565b03925af18015610a1857610ae2575080f35b6101e691505f90610bfe565b3461011557604036600319011261011557600435610b0b8161022d565b6024359060016001600160a01b038216141580610bd8575b61078d57811561077e5790610b3781612201565b610b626106885f946001600160a01b03165f525f5160206127ed5f395f51905f5260205260405f2090565b6001600160a01b0381168015159081610bcc575b5080610bc3575b1561070a576106fe61068882610b9a610bbd946106cd8988612233565b6001600160a01b03165f525f5160206127ed5f395f51905f5260205260405f2090565b92610b62565b50828410610b7d565b6001915014155f610b76565b50610be56107b58261274c565b610b23565b634e487b7160e01b5f52604160045260245ffd5b90601f8019910116810190811067ffffffffffffffff8211176104d657604052565b60405190610c2f604083610bfe565b565b908060209392818452848401375f828201840152601f01601f1916010190565b916020610c62938181520191610c31565b90565b6040513d5f823e3d90fd5b5f80356001600160e01b031981168083527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c02602052604090922054610cc96001600160a01b0382169160581b6001600160f81b03191690565b906001600160a01b038116610d1b57505060e01c63150b7a0263bc197c81821463f23a6e61831417911417610d14576308c63e2760e01b5f526001600160e01b03191660045260245ffd5b5f5260205ff35b5f5160206127cd5f395f51905f52546001600160a01b0316801515926060929084610e38575b6001600160f81b03198116607f60f91b03610de657505f8091610d6261227c565b90602082519201905afa92610d756114ee565b935b15610dde57610d89575b825160208401f35b803b1561011557604051630b9dfbed60e11b8152915f918391829084908290610db5906004830161151d565b03925af18015610a1857610dca575b80610d81565b80610a0c5f610dd893610bfe565b81610dc4565b835160208501fd5b6001600160f81b03198116610e1c57505f8091610e0161227c565b906020825192019034905af192610e166114ee565b93610d77565b632e5bf3f960e21b5f526001600160f81b03191660045260245ffd5b60405163d68f602560e01b81529093505f8180610e5a363433600485016114c8565b038183875af1908115610a18575f91610e75575b5092610d41565b610e8991503d805f833e610a378183610bfe565b85610e6e565b9095949395610e9c6122a9565b610ea461232b565b5f5b8181106110e9575050505f5b82811061105c575050505f5b828110610fcf57505050610ee0610ed482611160565b6001600160a01b031690565b610fa5575b505f5b828110610ef457505050565b80610f10610ed46020610f0a600195888861119d565b01611160565b15610fa057610f55610f2382868661119d565b35610f346020610f0a85898961119d565b90610f4d610f4385898961119d565b604081019061116a565b9290916120b1565b5f51602061278d5f395f51905f52610f6e82868661119d565b35610f7f6020610f0a85898961119d565b604080519283526001600160a01b0391909116602083015290a15b01610ee8565b610f9a565b610fc66103818261037c6103695f51602061278d5f395f51905f5295611160565b0390a15f610ee5565b80610fe3610ed461037c6001948787611139565b156110575761100d610ff961037c838787611139565b6110076103c9848888611139565b91611823565b5f51602061278d5f395f51905f5261104d61102c61037c848888611139565b60408051600381526001600160a01b03909216602083015290918291820190565b0390a15b01610ebe565b611051565b80611070610ed461037c6001948787611139565b156110e45761109a61108661037c838787611139565b6110946103c9848888611139565b91611723565b5f51602061278d5f395f51905f526110da6110b961037c848888611139565b60408051600281526001600160a01b03909216602083015290918291820190565b0390a15b01610eb2565b6110de565b806110fd6103bb61037c6001948688611139565b5f51602061278d5f395f51905f5261111c6103f861037c848789611139565b0390a101610ea6565b634e487b7160e01b5f52603260045260245ffd5b919081101561115b5760051b81013590603e1981360301821215610115570190565b611125565b35610c628161022d565b903590601e1981360301821215610115570180359067ffffffffffffffff82116101155760200191813603831361011557565b919081101561115b5760051b81013590605e1981360301821215610115570190565b979695976111cb6122a9565b6111d361232b565b6001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001691823b1561011557611228925f92836040518096819582946306d61fe760e41b845260048401610c51565b03925af18015610a1857611435575b505f5b8281106113cf575050505f5b828110611377575050505f5b82811061131f57505050611268610ed482611160565b6112f5575b505f5b82811061127c57505050565b80611292610ed46020610f0a600195888861119d565b156112f0576112a5610f2382868661119d565b5f51602061278d5f395f51905f526112be82868661119d565b356112cf6020610f0a85898961119d565b604080519283526001600160a01b0391909116602083015290a15b01611270565b6112ea565b6113166103818261037c6103695f51602061278d5f395f51905f5295611160565b0390a15f61126d565b80611333610ed461037c6001948787611139565b1561137257611349610ff961037c838787611139565b5f51602061278d5f395f51905f5261136861102c61037c848888611139565b0390a15b01611252565b61136c565b8061138b610ed461037c6001948787611139565b156113ca576113a161108661037c838787611139565b5f51602061278d5f395f51905f526113c06110b961037c848888611139565b0390a15b01611246565b6113c4565b806113e3610ed461037c6001948787611139565b15611430576114076113f961037c838787611139565b6103d36103c9848888611139565b5f51602061278d5f395f51905f526114266103f861037c848888611139565b0390a15b0161123a565b61142a565b80610a0c5f61144393610bfe565b5f611237565b67ffffffffffffffff81116104d657601f01601f191660200190565b6020818303126101155780519067ffffffffffffffff8211610115570181601f820112156101155780519061149982611449565b926114a76040519485610bfe565b8284526020838301011161011557815f9260208093018386015e8301015290565b610c6293926001600160a01b03606093168252602082015281604082015201905f610c31565b3d15611518573d906114ff82611449565b9161150d6040519384610bfe565b82523d5f602084013e565b606090565b906020610c629281815201906107be565b91906001600160a01b036115566001600160a01b035f5160206127cd5f395f51905f52541690565b16806115665750610c2f9261162b565b60405163d68f602560e01b81529290915f8480611588363433600485016114c8565b038183875af1938415610a18575f946115f3575b506115a892939461162b565b803b1561011557604051630b9dfbed60e11b8152915f9183918290849082906115d4906004830161151d565b03925af18015610a18576115e55750565b80610a0c5f610c2f93610bfe565b6115a893945061160c903d805f833e610a378183610bfe565b939261159c565b90816020910312610115575180151581036101155790565b60405163ecd0596160e01b8152600160048201526001600160a01b038216939190602081602481885afa908115610a18575f916116f4575b50156116e5576001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001684146116d6576116a29061239e565b806116ac57505050565b823b15610115576115d4925f92836040518096819582946306d61fe760e41b845260048401610c51565b63abc3af7960e01b5f5260045ffd5b631c4f83bb60e31b5f5260045ffd5b611716915060203d60201161171c575b61170e8183610bfe565b810190611613565b5f611663565b503d611704565b91906001600160a01b0361174b6001600160a01b035f5160206127cd5f395f51905f52541690565b168061175b5750610c2f926117bd565b60405163d68f602560e01b81529290915f848061177d363433600485016114c8565b038183875af1938415610a18575f9461179d575b506115a89293946117bd565b6115a89394506117b6903d805f833e610a378183610bfe565b9392611791565b60405163ecd0596160e01b8152600260048201526001600160a01b038216939190602081602481885afa908115610a18575f91611804575b50156116e5576116a2906124d6565b61181d915060203d60201161171c5761170e8183610bfe565b5f6117f5565b91906001600160a01b0361184b6001600160a01b035f5160206127cd5f395f51905f52541690565b168061185b5750610c2f92611a5e565b60405163d68f602560e01b81529290915f848061187d363433600485016114c8565b038183875af1938415610a18575f9461189d575b506115a8929394611a5e565b6115a89394506118b6903d805f833e610a378183610bfe565b9392611891565b906004116101155790600490565b909291928360051161011557831161011557600501916004190190565b356001600160e01b0319811692919060048210611903575050565b6001600160e01b031960049290920360031b82901b16169150565b906004101561115b5760040190565b1561193457565b63867a1dcf60e01b5f5260045ffd5b92919261194f82611449565b9161195d6040519384610bfe565b829481845281830111610115578281602093845f960137010152565b1561198057565b63c001660b60e01b5f5260045ffd5b156119975750565b63a56a04dd60e01b5f5263ffffffff60e01b1660045260245ffd5b7f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c035490680100000000000000008210156104d65760018201807f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c035582101561115b577f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c035f5260205f208260031c019163ffffffff60e084549260051b169260e01c831b921b1916179055565b60405163ecd0596160e01b81526003600482015291926001600160a01b03821692909190602081602481875afa908115610a18575f91611f0f575b50156116e557611cf28491611c77611b19611b128680611af0611ae3611ad583611acf611ac9611cf79e8e6118bd565b906118e8565b9b61191e565b356001600160f81b03191690565b6001600160f81b03191690565b9a6001600160f81b03198c16158015611ef8575b611b0d9061192d565b6118cb565b3691611943565b96611bf76001600160e01b031986166306d61fe760e41b8114908115611ee7575b8115611ed6575b8115611ec5575b8115611eb4575b8115611ea3575b8115611e92575b8115611e81575b8115611e70575b8115611e5f575b8115611e4e575b8115611e3d575b8115611e2c575b8115611e1b575b8115611e0a575b8115611df9575b8115611de8575b8115611dd7575b8115611dc6575b8115611db5575b8115611da4575b8115611d93575b8115611d82575b8115611d71575b8115611d60575b8115611d4f575b8115611d3e575b8115611d2d575b5015611979565b611c4c85611c476107b5826001600160e01b0319165f9081527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260409020546001600160a01b0316151590565b61198f565b611c66611c57610c20565b6001600160a01b039094168452565b6001600160f81b0319166020830152565b6001600160e01b031983165f9081527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c02602052604090208151815460209093015160ff60a01b60589190911c1674ffffffffffffffffffffffffffffffffffffffffff199093166001600160a01b0390911617919091179055565b6119b2565b8151611d01575050565b803b15610115576040516306d61fe760e41b8152915f9183918290849082906115d4906004830161151d565b63112d3a7d60e01b1490505f611bf0565b6314e2ec7560e31b81149150611be9565b639517e29f60e01b81149150611be2565b6335a4725960e21b81149150611bdb565b63e9ae5c5360e01b81149150611bd4565b639cfd7cff60e01b81149150611bcd565b63340f1e4560e21b81149150611bc6565b63f2dc691d60e01b81149150611bbf565b634b6a141960e01b81149150611bb8565b630b135d3f60e11b81149150611bb1565b638dd7712f60e01b81149150611baa565b63b760faf960e01b81149150611ba3565b6314add44b60e21b81149150611b9c565b6306608bdf60e21b81149150611b95565b632b870d1b60e11b81149150611b8e565b63ee21942360e01b81149150611b87565b637aa8f17760e11b81149150611b80565b639700320360e01b81149150611b79565b630b9dfbed60e11b81149150611b72565b63d68f602560e01b81149150611b6b565b637aa8f17760e11b81149150611b64565b639700320360e01b81149150611b5d565b63e24f8f9360e01b81149150611b56565b637a0468b760e01b81149150611b4f565b63d60b347f60e01b81149150611b48565b63ecd0596160e01b81149150611b41565b638a91b0e360e01b81149150611b3a565b50607f60f91b6001600160f81b03198d1614611b04565b611f28915060203d60201161171c5761170e8183610bfe565b5f611a99565b91906001600160a01b03611f566001600160a01b035f5160206127cd5f395f51905f52541690565b1680611f665750610c2f92611fec565b60405163d68f602560e01b81529290915f8480611f88363433600485016114c8565b038183875af1938415610a18575f94611fa8575b506115a8929394611fec565b6115a8939450611fc1903d805f833e610a378183610bfe565b9392611f9c565b15611fd05750565b6001600160a01b039063741cbe0360e01b5f521660045260245ffd5b60405163ecd0596160e01b81526004808201526001600160a01b038216939190602081602481885afa908115610a18575f91612092575b50156116e5576116a29061205e61204e6001600160a01b035f5160206127cd5f395f51905f52541690565b6001600160a01b03811615611fc8565b6001600160a01b03166001600160a01b03195f5160206127cd5f395f51905f525416175f5160206127cd5f395f51905f5255565b6120ab915060203d60201161171c5761170e8183610bfe565b5f612023565b9291906001600160a01b036120da6001600160a01b035f5160206127cd5f395f51905f52541690565b16806120ea5750610c2f9361214e565b60405163d68f602560e01b815293909290915f858061210e363433600485016114c8565b038183885af1948515610a18575f9561212e575b506115a893949561214e565b6115a8949550612147903d805f833e610a378183610bfe565b9493612122565b60405163ecd0596160e01b8152600481018290526001600160a01b03831694929190602081602481895afa908115610a18575f916121ca575b50156116e557612196816125c6565b6001600160a01b0381166121af5750906116a291612646565b63c689cd9760e01b5f526001600160a01b031660045260245ffd5b6121e3915060203d60201161171c5761170e8183610bfe565b5f612187565b67ffffffffffffffff81116104d65760051b60200190565b9061220b826121e9565b6122186040519182610bfe565b8281528092612229601f19916121e9565b0190602036910137565b805182101561115b5760209160051b010190565b634e487b7160e01b5f52601160045260245ffd5b5f1981146122695760010190565b612247565b5f1981019190821161226957565b60405190602036830101604052816014360181525f602036920137604051601481016040523360601b9052565b60015f525f5160206127ed5f395f51905f526020527fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f5546001600160a01b031661231c5760015f525f5160206127ed5f395f51905f52602052610c2f60405f2060016001600160a01b0319825416179055565b6329e42f3360e11b5f5260045ffd5b60015f525f5160206127ad5f395f51905f526020527f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf17546001600160a01b031661231c5760015f525f5160206127ad5f395f51905f52602052610c2f60405f2060016001600160a01b0319825416179055565b6001600160a01b038116801580156124cc575b6124ba575f9081525f5160206127ad5f395f51905f5260205260409020546001600160a01b031661249f5760015f525f5160206127ad5f395f51905f52602052610c2f906124646124217f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf17610688565b612449835f5160206127ad5f395f51905f52906001600160a01b03165f5260205260405f2090565b906001600160a01b03166001600160a01b0319825416179055565b60015f525f5160206127ad5f395f51905f526020527f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf17612449565b631034f46960e21b5f526001600160a01b031660045260245ffd5b637c84ecfb60e01b5f5260045260245ffd5b50600181146123b1565b6001600160a01b038116801580156125bc575b6124ba575f9081525f5160206127ed5f395f51905f5260205260409020546001600160a01b031661249f5760015f525f5160206127ed5f395f51905f52602052610c2f906125816125597fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f5610688565b612449835f5160206127ed5f395f51905f52906001600160a01b03165f5260205260405f2090565b60015f525f5160206127ed5f395f51905f526020527fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f5612449565b50600181146124e9565b600881036125fd57506001600160a01b037f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c09541690565b6009810361263457506001600160a01b037f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c08541690565b630f64246160e41b5f5260045260245ffd5b600881036126a957506001600160a01b03166001600160a01b03197f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c095416177f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0955565b6009810361263457506001600160a01b03166001600160a01b03197f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c085416177f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0855565b6001600160a01b031680600114159081612724575090565b90505f525f5160206127ad5f395f51905f526020526001600160a01b0360405f205416151590565b6001600160a01b031680600114159081612764575090565b90505f525f5160206127ed5f395f51905f526020526001600160a01b0360405f20541615159056fed21d0b289f126c4b473ea641963e766833c2f13866e4ff480abd787c100ef1239195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c009195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c069195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c01';

    // Load environment variables
    address defaultECDSAValidator = vm.envAddress('DEFAULT_ECDSA_VALIDATOR');
    bytes memory initData = abi.encodePacked(eEeEeAddress);

    bytes memory constructorArgs = abi.encode(defaultECDSAValidator, initData);

    // Concatenate bytecode + constructor arguments
    bytes memory finalBytecode = abi.encodePacked(deployedBytecode, constructorArgs);

    // Deploy contract if needed
    deployGeneric(deployerPrivateKey, saltString, finalBytecode, contractName);
  }

  function deployGeneric(
    uint256 deployerPrivateKey,
    string memory saltString,
    bytes memory finalBytecode,
    string memory contractName
  ) public {
    // Compute derived salt
    bytes32 derivedSalt = keccak256(abi.encodePacked(saltString));

    // Compute contract address before deployment
    address computedAddress = deployerInstance.addressOf(derivedSalt);

    console.log(string(abi.encodePacked(contractName, ' Computed Address:')), computedAddress);

    // Check if contract is already deployed
    uint256 codeSize;
    assembly {
      codeSize := extcodesize(computedAddress)
    }

    if (codeSize == 0) {
      console.log(string(abi.encodePacked(contractName, ' not deployed, deploying now...')));
      deployContract(deployerPrivateKey, derivedSalt, finalBytecode, contractName, computedAddress);
    } else {
      console.log(string(abi.encodePacked(contractName, ' already deployed at:')), computedAddress);
    }
  }

  function deployContract(
    uint256 deployerPrivateKey,
    bytes32 derivedSalt,
    bytes memory finalBytecode,
    string memory contractName,
    address computedAddress
  ) internal {
    uint256 chainId = block.chainid;

    uint256 gasPrice = DEPLOYMENT_CHAIN_GAS_PRICES[chainId];
    require(gasPrice > 0, NoGasPriceSet());

    console.log('Using gas price:', gasPrice);

    // Deploy contract using deployer's private key
    vm.startBroadcast(deployerPrivateKey);
    (bool success,) = address(deployerInstance).call{gas: 5_000_000}(
      abi.encodeWithSignature('deploy(bytes32,bytes)', derivedSalt, finalBytecode)
    );
    vm.stopBroadcast();

    require(success, ContractDeploymentFailed());

    console.log(string(abi.encodePacked('Transaction success: ', contractName)));

    // Verify deployment by checking contract existence
    uint256 codeSize;
    assembly {
      codeSize := extcodesize(computedAddress)
    }

    if (codeSize == 0) {
      console.log(string(abi.encodePacked('Invalid deployment of ', contractName)));
    } else {
      console.log(string(abi.encodePacked(contractName, ' Deployed Successfully at:')), computedAddress);
    }
  }
}
