// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.29;

import '../src/deployer/Deployer.sol';
import {Script, console} from 'forge-std/Script.sol';

contract DeployStartaleAccountImplementationCreate3 is Script {
  Deployer deployerInstance;
  address entryPoint;
  mapping(uint256 => uint256) public DEPLOYMENT_CHAIN_GAS_PRICES;
  address public constant eEeEeAddress = address(0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE);

  error NoGasPriceSet();
  error ContractDeploymentFailed();

  function setUp() public {
    deployerInstance = Deployer(vm.envAddress('DEPLOYER_CONTRACT_ADDRESS')); // Set Deployer contract
    // EntryPoint v0.7 address
    entryPoint = vm.parseAddress('0x0000000071727De22E5E9d8BAf0edAc6f37da032');
    DEPLOYMENT_CHAIN_GAS_PRICES[1946] = 0.002 gwei;
    DEPLOYMENT_CHAIN_GAS_PRICES[1868] = 0.001 gwei;
  }

  function run() public {
    uint256 deployerPrivateKey = vm.envUint('PRIVATE_KEY');

    string memory contractName = 'StartaleSmartAccount';
    string memory saltString = vm.envString('STARTALE_SMART_ACCOUNT_IMPLEMENTATION_SALT');

    bytes memory deployedBytecode =
      hex'610180806040523461031b57616aeb803803809161001d8285610387565b833981019060608183031261031b57610035816103aa565b90610042602082016103aa565b604082015190916001600160401b03821161031b57019280601f8501121561031b5783516001600160401b038111610373576040519461008c601f8301601f191660200187610387565b81865260208601926020838301011161031b57815f926020809301855e86010152306080524660a05260409360a085516100c68782610387565b600881526020810190675374617274616c6560c01b82528751916100ea8984610387565b60058352640312e302e360dc1b6020938401529051902060c08190527f06c015bd22b4c69690933c1058878ebdfef31f9aaae40bbe86d8a09fe1b2972c60e081905288517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f815280840192909252818901524660608201523060808201529190912061010052855163ecd0596160e01b8152600160048201526001600160a01b038516939181602481875afa908115610369575f9161032e575b501561031f57823b1561031b576044925f928388519586809581946306d61fe760e41b8352602060048401525180918160248501528484015e8181018301849052601f01601f191681010301925af1801561031157610301575b506101405230610160526001600160a01b038116156102f257610120525161672c90816103bf82396080518161608e015260a051816160b1015260c05181616121015260e051816161470152610100518161606d0152610120518181816102730152818161048e015281816106420152818161096d01528181610ae4015281816111fb0152818161144401528181611513015281816117b6015281816118ef0152818161195101528181611c5101528181611cca01526126b301526101405181818161253301528181612aa90152818161341a015281816142630152615d61015261016051818181610ca701526126840152f35b6307e355bf60e31b5f5260045ffd5b5f61030b91610387565b5f6101fe565b84513d5f823e3d90fd5b5f80fd5b631c4f83bb60e31b5f5260045ffd5b90506020813d602011610361575b8161034960209383610387565b8101031261031b5751801515810361031b575f6101a4565b3d915061033c565b87513d5f823e3d90fd5b634e487b7160e01b5f52604160045260245ffd5b601f909101601f19168101906001600160401b0382119082101761037357604052565b51906001600160a01b038216820361031b5756fe60806040526004361015610015575b36612dd857005b5f3560e01c806203f25f1461023357806301ffc9a71461022e5780630a664dba14610229578063112d3a7d146102245780631626ba7e1461021f57806319822f7c1461021a578063392e53cd1461021557806346f8034414610210578063481ddd231461020b578063492a88a2146102065780634a58db19146102015780634b6a1419146101fc5780634d44560d146101f75780634f1ef286146101f257806352d1902d146101ed5780635bfeadbb146101e85780635faac46b146101e3578063619810d4146101de57806384b0196e146101d95780638626e88b146101d45780638dd7712f146101cf5780639517e29f146101ca5780639cfd7cff146101c5578063a71763a8146101c0578063aaf10f42146101bb578063b0d691fe146101b6578063b46b61a9146101b1578063c399ec88146101ac578063d03c7914146101a7578063d691c964146101a2578063d86f2b3c1461019d578063e9ae5c5314610198578063ea5f61d0146101935763f2dc691d0361000e57611e85565b611d89565b611cb3565b611bd9565b611a92565b611982565b61192c565b611913565b6118d0565b61188b565b6117a2565b611743565b6114ff565b61140b565b61134d565b61125a565b6111d6565b611017565b610d02565b610c94565b610b6c565b610ac1565b610995565b61095b565b610743565b6106ae565b6105e6565b6105cc565b61043d565b610403565b6103b7565b6102f0565b6102b5565b61024e565b6001600160e01b031981160361024a57565b5f80fd5b602036600319011261024a576102aa60043561026981610238565b6001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016331480156102ac575b6102a590611ea3565b6131c1565b005b5033301461029c565b3461024a57602036600319011261024a5760206102dc6004356102d781610238565b611ed2565b6040519015158152f35b5f91031261024a57565b3461024a575f36600319011261024a5760206001600160a01b035f5160206166cc5f395f51905f5254166001600160a01b0360405191168152f35b6001600160a01b0381160361024a57565b35906103478261032b565b565b9181601f8401121561024a5782359167ffffffffffffffff831161024a576020838186019501011161024a57565b606060031982011261024a57600435916024356103938161032b565b916044359067ffffffffffffffff821161024a576103b391600401610349565b9091565b3461024a5760206102dc6103ca36610377565b9291909161333f565b90604060031983011261024a57600435916024359067ffffffffffffffff821161024a576103b391600401610349565b3461024a57602061041c610416366103d3565b916121c4565b6001600160e01b031960405191168152f35b908161012091031261024a5790565b3461024a57606036600319011261024a5760043567ffffffffffffffff811161024a5761047161052591369060040161042e565b60206104ed6024356104f860443580956104b56001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000163314611ea3565b6104f26104c23683612327565b9586928881013590600382901a60f81b600160f81b1461059d575b5060401c6001600160a01b031690565b613407565b936136b7565b61010084929401525f6001600160a01b03604051809881968295639700320360e01b8452600484016124dc565b0393165af190811561059857610554925f92610567575b5080610558575b506040519081529081906020820190565b0390f35b5f80808093335af1505f610543565b81925061058b9060203d602011610591575b610583818361215a565b81019061243a565b9161053c565b503d610579565b6121b9565b6105b96105b2826101006105c0940190612407565b908a61358d565b36916122d6565b6101008501525f6104dd565b3461024a575f36600319011261024a5760206102dc612510565b602036600319011261024a5760043567ffffffffffffffff811161024a573660238201121561024a5780600401359067ffffffffffffffff821161024a576024810190602436918460051b01011161024a576001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016331480156106a5575b61067490611ea3565b5f5b82811061067f57005b8061069f61069060019386866137e3565b3561069a81610238565b613b7b565b01610676565b5033301461066b565b3461024a57602036600319011261024a57604060206107096004356106d281610238565b6001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b82519061071582612139565b54906001600160f81b03196001600160a01b0383169283835260581b16928391015282519182526020820152f35b3461024a575f36600319011261024a573033036109335761076261617d565b61076a616203565b6001600160a01b036107906001600160a01b035f5160206166cc5f395f51905f52541690565b16610912575b6107cf6107ca6001600160a01b037f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c09541690565b6149ee565b6108086108036001600160a01b037f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c08541690565b614a3a565b5f5160206166ec5f395f51905f52545f5b81811061084457610828614a86565b610830614aff565b610838614bb6565b60405160018152602090f35b8061090c610853600193613031565b90549060031b1c60e01b6108ad6040519161086d83612139565b5f83525f60208401526001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b8151815460209093015174ff000000000000000000000000000000000000000060589190911c167fffffffffffffffffffffff0000000000000000000000000000000000000000009093166001600160a01b0390911617919091179055565b01610819565b5f5160206166cc5f395f51905f5280546001600160a01b0319169055610796565b7f0e93a1f9000000000000000000000000000000000000000000000000000000005f5260045ffd5b5f36600319011261024a575f388180347f00000000000000000000000000000000000000000000000000000000000000005af11561024a57005b602036600319011261024a5760043567ffffffffffffffff811161024a576109c1903690600401610349565b303303610a8e575b601811610a66575f80916109db614cc4565b610a59575b602080820135820180358060405193849301833781018481520391355af4610a066128a1565b5015610a3157610a1b610a17614cc4565b1590565b610a2157005b6102aa610a2c612510565b6137f3565b7f36f2eeee000000000000000000000000000000000000000000000000000000005f5260045ffd5b610a61614ce6565b6109e0565b7ff9c42c60000000000000000000000000000000000000000000000000000000005f5260045ffd5b7f754fd8b321c4649cb777ae6fdce7e89e9cceaa31a4f639795c7807eb7f1a27005c6109c95763aed595955f526004601cfd5b604036600319011261024a57600435610ad98161032b565b5f80604460243593827f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03811633148015610b63575b610b1f90611ea3565b6040519687937f205c2878000000000000000000000000000000000000000000000000000000008552600485015260248401525af115610b5b57005b3d90815f823efd5b50333014610b16565b604036600319011261024a57600435610b848161032b565b60243567ffffffffffffffff811161024a57610ba4903690600401610349565b906001600160a01b03610bcb6001600160a01b035f5160206166cc5f395f51905f52541690565b1680610bdb57506102aa92612668565b90916040519263d68f602560e01b84525f8480610bfd36343360048501612631565b038183875af1938415610598575f94610c6c575b50610c1d929394612668565b803b1561024a57610c485f92918392604051948580948193630b9dfbed60e11b835260048301612657565b03925af1801561059857610c5857005b80610c665f6102aa9361215a565b806102e6565b610c1d939450610c8d903d805f833e610c85818361215a565b8101906125eb565b9392610c11565b3461024a575f36600319011261024a57307f000000000000000000000000000000000000000000000000000000000000000003610cf55760206040517f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc8152f35b639f03a0265f526004601cfd5b604036600319011261024a5760043567ffffffffffffffff811161024a5780600401906080600319823603011261024a5760243567ffffffffffffffff811161024a57610d56610d5d913690600401610349565b9084613880565b610d796024820135926044610d7182612805565b930190612407565b9290600482148015610fb6575b828115610fab575b610d979161280f565b610dad8383610da88785848461333f565b612842565b610de7836001600160a01b03165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0760205260405f2090565b5480610e78575050507f2841d18703faaff388732165e48fe431468531b1b1e626b1b7cbcbfc0d79c7409150610e739042610e52826001600160a01b03165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0760205260405f2090565b55604080516001600160a01b03909216825242602083015290918291820190565b0390a1005b610e856203f48082612894565b4210610ef0575050507fcbd44a75f6935b5837022648b6c8487db984701200c5381c7c0f8c2b1d69b9da9150610e739042610e52826001600160a01b03165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0760205260405f2090565b610ef990612884565b4210610f83577f341347516a9de374859dfda710fa4828b2d48cb57d4fbe4c1149612b8e02276e93610f68915f610f60866001600160a01b03165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0760205260405f2090565b558385613a16565b604080519182526001600160a01b03929092166020820152a1005b7f07f2f2d2000000000000000000000000000000000000000000000000000000005f5260045ffd5b600981149150610d8e565b5060088214610d86565b90929192604082016040835281518091526020606084019201905f5b818110610ff8575050506001600160a01b036020919416910152565b82516001600160a01b0316845260209384019390920191600101610fdc565b3461024a57604036600319011261024a576004356110348161032b565b6024359060016001600160a01b0382161415806111c4575b6111a9578115611181579061106081614fdf565b61109861108b5f946001600160a01b03165f525f5160206166ac5f395f51905f5260205260405f2090565b546001600160a01b031690565b6001600160a01b0381168015159081611175575b508061116c575b1561110d5761110161108b826110de611107946110d08988614506565b906001600160a01b03169052565b6001600160a01b03165f525f5160206166ac5f395f51905f5260205260405f2090565b93615011565b92611098565b908360016001600160a01b038416141580611163575b611139575b815261055460405192839283610fc0565b915061115d61115061114a84613107565b83614506565b516001600160a01b031690565b91611128565b50801515611123565b508284106110b3565b6001915014155f6110ac565b7ff7250817000000000000000000000000000000000000000000000000000000005f5260045ffd5b637c84ecfb60e01b5f526001600160a01b031660045260245ffd5b506111d1610a17826143de565b61104c565b602036600319011261024a576102aa6004356111f181610238565b6001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000163314801561122d575b61069a90611ea3565b50333014611224565b805180835260209291819084018484015e5f828201840152601f01601f1916010190565b3461024a575f36600319011261024a576112b56112c3611278613c46565b6040929192519384937f0f00000000000000000000000000000000000000000000000000000000000000855260e0602086015260e0850190611236565b908382036040850152611236565b4660608301523060808301525f60a083015281810360c083015260206060519182815201906080905f5b8181106112fb575050500390f35b82518452859450602093840193909201916001016112ed565b60206040818301928281528451809452019201905f5b8181106113375750505090565b825184526020938401939092019160010161132a565b3461024a575f36600319011261024a576040518060207fc473de86d0138e06e4d4918a106463a7cc005258d2e21915272bcb4594c18900549182815201907fc473de86d0138e06e4d4918a106463a7cc005258d2e21915272bcb4594c189005f527fdb3901c0862740f848a4aebebd6b3d645e6b3bc6adf2cf46e83a846b3a343933905f5b8181106113f557610554856113e98187038261215a565b60405191829182611314565b82548452602090930192600192830192016113d2565b604036600319011261024a5760043567ffffffffffffffff811161024a5761143790369060040161042e565b61146b6001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000163314611ea3565b6001600160a01b036114916001600160a01b035f5160206166cc5f395f51905f52541690565b16806114a157506102aa906128d0565b6040519163d68f602560e01b83525f83806114c136343360048501612631565b038183865af1928315610598575f936114df575b50610c1d906128d0565b610c1d9193506114f8903d805f833e610c85818361215a565b92906114d5565b61150836610377565b906001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000163314801561173a575b61154590611ea3565b611550610a17613753565b61172d575b6001600160a01b0383161561170557600184036115ba577fd21d0b289f126c4b473ea641963e766833c2f13866e4ff480abd787c100ef12393916115999184615c7f565b604080519182526001600160a01b0390921660208201529081908101610e73565b600284036115f4577fd21d0b289f126c4b473ea641963e766833c2f13866e4ff480abd787c100ef12393916115ef9184615b7f565b611599565b60038403611629577fd21d0b289f126c4b473ea641963e766833c2f13866e4ff480abd787c100ef12393916115ef91846154ab565b6004840361165e577fd21d0b289f126c4b473ea641963e766833c2f13866e4ff480abd787c100ef12393916115ef918461533e565b6008841480156116fb575b1561169c5783916115ef91847fd21d0b289f126c4b473ea641963e766833c2f13866e4ff480abd787c100ef12396615155565b836116ce577fd21d0b289f126c4b473ea641963e766833c2f13866e4ff480abd787c100ef12393916115ef9184615036565b7f098312d2000000000000000000000000000000000000000000000000000000005f52600484905260245ffd5b5060098414611669565b7f5316c18d000000000000000000000000000000000000000000000000000000005f5260045ffd5b611735614bb6565b611555565b5033301461153c565b3461024a575f36600319011261024a5761055460405161176460408261215a565b601c81527f7374617274616c652e736d6172742d6163636f756e742e312e302e30000000006020820152604051918291602083526020830190611236565b6117ab36610377565b916001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001633148015611882575b6117e890611ea3565b6001600160a01b0361180e6001600160a01b035f5160206166cc5f395f51905f52541690565b168061181e57506102aa93612945565b916040939193519363d68f602560e01b85525f858061184236343360048501612631565b038183885af1948515610598575f95611862575b50610c1d939495612945565b610c1d94955061187b903d805f833e610c85818361215a565b9493611856565b503330146117df565b3461024a575f36600319011261024a5760207f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc546001600160a01b0360405191168152f35b3461024a575f36600319011261024a5760206040516001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000168152f35b3461024a57602061041c611926366103d3565b91612a23565b3461024a575f36600319011261024a57306020526370a082315f52602080806024601c7f00000000000000000000000000000000000000000000000000000000000000005afa601f3d1116815102604051908152f35b3461024a57602036600319011261024a576105546004358060081b6001600160f81b0319821615918215611a1b575b8215611a06575b50816119d2575b5060405190151581529081906020820190565b6001600160f81b0319811615915081156119ee575b505f6119bf565b6001600160f81b031916600160f81b1490505f6119e7565b6001600160f81b03199081161491505f6119b8565b6001600160f81b03198116600160f81b1492506119b1565b602081016020825282518091526040820191602060408360051b8301019401925f915b838310611a6557505050505090565b9091929394602080611a83600193603f198682030187528951611236565b97019301930191939290611a56565b611a9b366103d3565b91611aa53361441e565b15611bad576001600160a01b03611ad06001600160a01b035f5160206166cc5f395f51905f52541690565b1680611af1575091611ae59161055493612af5565b60405191829182611a33565b90926040519263d68f602560e01b84525f8480611b1336343360048501612631565b038183875af1938415610598575f94611b8d575b50611b33929394612af5565b90803b1561024a57611b5f5f93918492604051958680948193630b9dfbed60e11b835260048301612657565b03925af19182156105985761055492611b79575b50611ae5565b80610c665f611b879361215a565b5f611b73565b611b33939450611ba6903d805f833e610c85818361215a565b9392611b27565b7fb927fe5e000000000000000000000000000000000000000000000000000000005f523360045260245ffd5b3461024a57602036600319011261024a5760043577ffffffffffffffffffffffffffffffffffffffffffffffff811680910361024a57604051907f35567e1a00000000000000000000000000000000000000000000000000000000825230600483015260248201526020816044816001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000165afa801561059857610554915f91611c9457506040519081529081906020820190565b611cad915060203d60201161059157610583818361215a565b5f610543565b611cbc366103d3565b90611cf16001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000163314611ea3565b6001600160a01b03611d176001600160a01b035f5160206166cc5f395f51905f52541690565b1680611d2757506102aa92612c47565b90916040519263d68f602560e01b84525f8480611d4936343360048501612631565b038183875af1938415610598575f94611d69575b50610c1d929394612c47565b610c1d939450611d82903d805f833e610c85818361215a565b9392611d5d565b3461024a57604036600319011261024a57600435611da68161032b565b6024359060016001600160a01b038216141580611e73575b6111a95781156111815790611dd281614fdf565b611dfd61108b5f946001600160a01b03165f525f51602061670c5f395f51905f5260205260405f2090565b6001600160a01b0381168015159081611e67575b5080611e5e575b1561110d5761110161108b82611e35611e58946110d08988614506565b6001600160a01b03165f525f51602061670c5f395f51905f5260205260405f2090565b92611dfd565b50828410611e18565b6001915014155f611e11565b50611e80610a178261441e565b611dbe565b3461024a57602036600319011261024a5760206102dc600435612d5b565b15611eaa57565b7fac52ccbe000000000000000000000000000000000000000000000000000000005f5260045ffd5b6001600160e01b031981167f150b7a02000000000000000000000000000000000000000000000000000000008114908115611fff575b8115611fd5575b8115611fc4575b8115611fb3575b8115611fa2575b8115611f78575b50611f7257611f6d60ff916001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0460205260405f2090565b541690565b50600190565b7fbe1d6cf6000000000000000000000000000000000000000000000000000000009150145f611f2b565b630b135d3f60e11b81149150611f24565b634b6a141960e01b81149150611f1d565b630b135d3f60e11b81149150611f16565b7f01ffc9a70000000000000000000000000000000000000000000000000000000081149150611f0f565b7f4e2312e00000000000000000000000000000000000000000000000000000000081149150611f08565b634e487b7160e01b5f52601160045260245ffd5b90617739820291808304617739149015171561205557565b612029565b9060141161024a5790601490565b909291928360141161024a57831161024a57601401916013190190565b9060041161024a5790600490565b909291928360041161024a57831161024a57600401916003190190565b909291928360051161024a57831161024a57600501916004190190565b9093929384831161024a57841161024a578101920390565b356bffffffffffffffffffffffff19811692919060148210612105575050565b6bffffffffffffffffffffffff1960149290920360031b82901b16169150565b634e487b7160e01b5f52604160045260245ffd5b6040810190811067ffffffffffffffff82111761215557604052565b612125565b90601f8019910116810190811067ffffffffffffffff82111761215557604052565b9081602091031261024a575161219181610238565b90565b61219193926001600160a01b0360609316825260208201528160408201520190611236565b6040513d5f823e3d90fd5b91801561227d575b9061220661222d9361220084806121fa6104ed6121f46121ee60209a8a61205a565b906120e5565b60601c90565b95612068565b916134cc565b91906001600160a01b03604051809681958294637aa8f17760e11b84523360048501612194565b0392165afa5f918161224c575b5061219157506001600160e01b031990565b61226f91925060203d602011612276575b612267818361215a565b81019061217c565b905f61223a565b503d61225d565b61228b61ffff82190461203d565b83036121cc579061219192612a23565b604051906103476101208361215a565b6040519061034760408361215a565b67ffffffffffffffff811161215557601f01601f191660200190565b9291926122e2826122ba565b916122f0604051938461215a565b82948184528183011161024a578281602093845f960137010152565b9080601f8301121561024a57816020612191933591016122d6565b9190916101208184031261024a5761233d61229b565b926123478261033c565b845260208201356020850152604082013567ffffffffffffffff811161024a578161237391840161230c565b6040850152606082013567ffffffffffffffff811161024a578161239891840161230c565b60608501526080820135608085015260a082013560a085015260c082013560c085015260e082013567ffffffffffffffff811161024a57816123db91840161230c565b60e085015261010082013567ffffffffffffffff811161024a576123ff920161230c565b610100830152565b903590601e198136030182121561024a570180359067ffffffffffffffff821161024a5760200191813603831361024a57565b9081602091031261024a575190565b80516001600160a01b0316825261219191602082015160208201526101006124ca61249a61248860408601516101206040870152610120860190611236565b60608601518582036060870152611236565b6080850151608085015260a085015160a085015260c085015160c085015260e085015184820360e0860152611236565b92015190610100818403910152611236565b9291906124f3602091604086526040860190612449565b930152565b9081602091031261024a5751801515810361024a5790565b60405163d60b347f60e01b81523060048201526020816024816001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000165afa908115610598575f91612576575b50801561256d5790565b50612191613753565b612598915060203d60201161259e575b612590818361215a565b8101906124f8565b5f612563565b503d612586565b81601f8201121561024a578051906125bc826122ba565b926125ca604051948561215a565b8284526020838301011161024a57815f9260208093018386015e8301015290565b9060208282031261024a57815167ffffffffffffffff811161024a5761219192016125a5565b908060209392818452848401375f828201840152601f01601f1916010190565b61219193926001600160a01b03606093168252602082015281604082015201905f612611565b906020612191928181520190611236565b9190916001600160a01b0381169081156127dd573b156127dd577f00000000000000000000000000000000000000000000000000000000000000003014610cf5576001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016331480156127d4575b6126e590611ea3565b6126ed614cc4565b6127ac573d5f526352d1902d6001527f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc602060016004601d855afa510361279e57807fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b5f80a281817f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc5561278057505050565b815f926040519485378338925af4156127965750565b3d5f823e3d90fd5b6355299b496001526004601dfd5b7fdc3b8379000000000000000000000000000000000000000000000000000000005f5260045ffd5b503330146126dc565b7fc970156c000000000000000000000000000000000000000000000000000000005f5260045ffd5b356121918161032b565b156128175750565b7f41c38b30000000000000000000000000000000000000000000000000000000005f5260045260245ffd5b1561284b575050565b6001600160a01b0392507fbe601672000000000000000000000000000000000000000000000000000000005f526004521660245260445ffd5b9062015180820180921161205557565b9190820180921161205557565b3d156128cb573d906128b2826122ba565b916128c0604051938461215a565b82523d5f602084013e565b606090565b6128de906060810190612407565b8060041161024a576040515f9283929060031982019060040183378101826003198201528160031991030190305af46129156128a1565b501561291d57565b7facfdb444000000000000000000000000000000000000000000000000000000005f5260045ffd5b90917f341347516a9de374859dfda710fa4828b2d48cb57d4fbe4c1149612b8e02276e9361297a8484610da88486848461333f565b600183036129b65761298c9184614038565b612994614123565b604080519182526001600160a01b03909216602082015290819081015b0390a1565b600283036129cd576129c89184613e70565b612994565b600383036129df576129c89184613cb9565b600483148015612a19575b8015612a0f575b6129fd575b5050612994565b612a08918385613a16565b5f806129f6565b50600983146129f1565b50600883146129ea565b60015f9081525f5160206166ac5f395f51905f526020527f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf17546001600160a01b031694939291905b6001600160a01b0386168015159081612ae9575b5015612aa157612a95848484612a9b948a6142c1565b95614399565b94612a6b565b612acd9495507f00000000000000000000000000000000000000000000000000000000000000006142c1565b6001600160e01b0319811661219157506001600160e01b031990565b6001915014155f612a7f565b91908260081b92612b0e816001600160f81b0319161590565b15612b1f575090612191929161462e565b6001600160f81b03198116600160f81b03612b405750906121919291614540565b6001600160f81b031980821603612c2a575090612b5c91615dd7565b9091612b66614476565b936001600160f81b03198116612b98575091612b8192615e16565b612b8a826144f9565b52612b94816144f9565b5090565b6001600160f81b03198116600160f81b03612c0e57508183612bb992615df1565b612bc2856144f9565b5215612bcd57505090565b7f5bd4c60b4b38b664d8fb5944eb974e3d85083d79afe5ce934ccabcc913707c1091612c08612bfb856144f9565b516040519384938461451a565b0390a190565b6308c3ee0360e11b5f526001600160f81b03191660045260245ffd5b6001600160f81b031990632e5bf3f960e21b5f521660045260245ffd5b91908260081b92612c60816001600160f81b0319161590565b15612c715750906103479291614777565b6001600160f81b03198116600160f81b03612c9257509061034792916146ee565b6001600160f81b031980821603612c2a575090612cae91615dd7565b929091906001600160f81b03198116612cdc57505f9083604051938437838338925af4156127965701604052565b9192916001600160f81b03198116600160f81b03612d3e57508183612d0092615df1565b929015612d0d575b505050565b6129b17f5bd4c60b4b38b664d8fb5944eb974e3d85083d79afe5ce934ccabcc913707c10936040519384938461451a565b6001600160f81b0319906308c3ee0360e11b5f521660045260245ffd5b60018114908115612dcd575b8115612dc2575b8115612db7575b8115612dac575b8115612da1575b8115612d98575b50612d93575f90565b600190565b9050155f612d8a565b600981149150612d83565b600881149150612d7c565b600481149150612d75565b600381149150612d6e565b600281149150612d67565b5f356001600160e01b0319811690612e21826001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b54612e406001600160a01b0382169160581b6001600160f81b03191690565b906001600160a01b038116612eab57505060e01c63150b7a0263bc197c81821463f23a6e61831417911417612ea4577f08c63e27000000000000000000000000000000000000000000000000000000005f526001600160e01b03191660045260245ffd5b5f5260205ff35b5f5160206166cc5f395f51905f52546001600160a01b0316801515926060929084612fc7575b6001600160f81b03198116607f60f91b03612f7557505f8091612ef261603e565b90602082519201905afa92612f056128a1565b935b15612f6d57612f19575b825160208401f35b803b1561024a57612f445f92918392604051948580948193630b9dfbed60e11b835260048301612657565b03925af1801561059857612f59575b80612f11565b80610c665f612f679361215a565b81612f53565b835160208501fd5b6001600160f81b03198116612fab57505f8091612f9061603e565b906020825192019034905af192612fa56128a1565b93612f07565b632e5bf3f960e21b5f526001600160f81b03191660045260245ffd5b925060405163d68f602560e01b81525f8180612fe836343360048501612631565b038183875af1908115610598575f91613003575b5092612ed1565b61301791503d805f833e610c85818361215a565b85612ffc565b634e487b7160e01b5f52603260045260245ffd5b905f5160206166ec5f395f51905f5254821015613089575f5160206166ec5f395f51905f525f52600382901c7f83f9b619edc9f43576821d856bc19cf4dff9f52048e1eda1b7c8f88ea11af5ea019160021b601c1690565b61301d565b905f51602061668c5f395f51905f5254821015613089575f51602061668c5f395f51905f525f52600382901c7f03091a1950aec911b7d69775d400f97274a68b1ca29a0c9bfcd94d200ed924b6019160021b601c1690565b9190918054831015613089575f52601c60205f208360031c019260021b1690565b5f1981019190821161205557565b5f51602061668c5f395f51905f5254801561316a575f1901613159613147825f51602061668c5f395f51905f526130e6565b63ffffffff82549160031b1b19169055565b5f51602061668c5f395f51905f5255565b634e487b7160e01b5f52603160045260245ffd5b5f5160206166ec5f395f51905f5254801561316a575f19016131b0613147825f5160206166ec5f395f51905f526130e6565b5f5160206166ec5f395f51905f5255565b6131fc816001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0460205260405f2090565b805460ff191690555f51602061668c5f395f51905f5254905f5b82811061325d575b506040516001600160e01b031990911681527f98eb65738803b92e5252c82c101f74513bea5f86a503594d3f36684fb726090b915080602081016129b1565b6132668161308e565b90549060031b1c60e01b6001600160e01b031980841691161461328b57600101613216565b906132fb6129b1926132de6132d86132cb6132c67f98eb65738803b92e5252c82c101f74513bea5f86a503594d3f36684fb726090b98613107565b61308e565b90549060031b1c60e01b90565b9161308e565b90919063ffffffff83549160031b9260e01c831b921b1916179055565b613303613115565b9061321e565b919091356001600160e01b031981169260048110613325575050565b6001600160e01b0319929350829060040360031b1b161690565b9290916001840361335657505061219191506143de565b6002840361336a575050612191915061441e565b6003840361339f57612191935060048210613397576133929161338c91612085565b90613309565b6148a9565b50505f6148a9565b505090600481145f146133cd57505f5160206166cc5f395f51905f52546001600160a01b0391821691161490565b6008811480156133fd575b156133f7576001600160a01b036133ef8192614810565b921691161490565b50505f90565b50600981146133d8565b6001600160a01b0381168061343c5750507f000000000000000000000000000000000000000000000000000000000000000090565b613445826143de565b1561344e575090565b7f6859e01e000000000000000000000000000000000000000000000000000000005f5260045260245ffd5b91909160408184031261024a57805192602082015167ffffffffffffffff811161024a5761219192016125a5565b61219194926001600160a01b0360609316825260208201528160408201520191612611565b7f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c09549293926001600160a01b03168061350d575090612191919336916122d6565b604051637a0468b760e01b8152945f938693849283926135319233600486016134a7565b03915afa918215610598575f905f9361354957509190565b90506103b39192503d805f833e613560818361215a565b810190613479565b6001600160a01b03612191959360609383521660208201528160408201520191612611565b9290916014830136811161024a57833560601c603485019136831161024a57359136605487011161024a573560e01c916038860193838701966038880136811161024a573660588a011161024a573560e01c9788603c8201910136603c82011161024a576136349a61363e8861361687876136439960048f98610a179b603891030101916120cd565b9e909e9d8061362e6104ed6121f46121ee848c61205a565b97612068565b949093898b6148f5565b614969565b61368f57303b1561024a5761366e5f936040519586948594639517e29f60e01b865260048601613568565b038134305af18015610598576136815750565b80610c665f6103479361215a565b7f46fdc333000000000000000000000000000000000000000000000000000000005f5260045ffd5b92916001600160a01b036136f26001600160a01b037f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c08541690565b1680613702575050610100015190565b6137305f80946040979497519788958694859363e24f8f9360e01b8552606060048601526064850190612449565b916024840152604483015203925af1918215610598575f905f9361354957509190565b60015f525f5160206166ac5f395f51905f526020527f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf17546001600160a01b031615158061379d5790565b5060015f525f51602061670c5f395f51905f526020527fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f5546001600160a01b0316151590565b91908110156130895760051b0190565b156137fa57565b7f7556034e000000000000000000000000000000000000000000000000000000005f5260045ffd5b1561382957565b7f756688fe000000000000000000000000000000000000000000000000000000005f5260045ffd5b1561385857565b7fbf6b5843000000000000000000000000000000000000000000000000000000005f5260045ffd5b6020916001600160a01b039161396161398295806138a76104ed6121f46121ee848961205a565b9461395c61394f6138db6138ba88612805565b60608c8a0135996138ce6040820182612407565b92909101359a8b93614e30565b9661392261391d610a17613916845f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0a60205260405f2090565b5460ff1690565b613822565b5f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0a60205260405f2090565b805460ff19166001179055565b612068565b93909160405196879586948593637aa8f17760e11b855230600486016134a7565b0392165afa8015610598576001600160e01b0319630b135d3f60e11b91610347935f916139b2575b501614613851565b6139cb915060203d60201161227657612267818361215a565b5f6139aa565b916020612191938181520191612611565b91613a08906001600160a01b036121919593168452606060208501526060840190611236565b916040818403910152611236565b9192919060048103613af757505f5160206166cc5f395f51905f5280546001600160a01b03191690555b613a7b5a60405190638a91b0e360e01b6020830152613a7582613a678789602484016139d1565b03601f19810184528361215a565b83614f94565b939015613a89575b50505050565b7fb6847a3240c9f4a4bedda5dac3ad17fe3eed74aec7c32aac50b131e7c893bd9b93613adf613aeb92613ad1604051968792638a91b0e360e01b6020850152602484016139d1565b03601f19810186528561215a565b604051938493846139e2565b0390a15f808080613a83565b8284600883148015613b23575b613b11575b505050613a40565b613b1b9284614ea9565b5f8284613b09565b5060098314613b04565b5f5160206166ec5f395f51905f52549068010000000000000000821015612155576132de82600161034794015f5160206166ec5f395f51905f52555f5160206166ec5f395f51905f526130e6565b613bb6816001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0460205260405f2090565b805460ff191660011790555f51602061668c5f395f51905f5254680100000000000000008110156121555781613c337f5daa3de47b1e487939a83a2b82cc20cc90ba74a30933b87eb780462db05db836936132de846001602096015f51602061668c5f395f51905f52555f51602061668c5f395f51905f526130e6565b6001600160e01b031960405191168152a1565b6040908151613c55838261215a565b600881527f5374617274616c65000000000000000000000000000000000000000000000000602082015291613c8c8151918261215a565b600581527f312e302e30000000000000000000000000000000000000000000000000000000602082015290565b9190613cc861338c8383612085565b92613d18613cd46122ab565b5f81525f60208201526108ad866001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b5f5160206166ec5f395f51905f52546001600160e01b03195f9516945b818110613dd7575b505090919250613d76613a755a613d55868087612093565b9290613a67604051948592638a91b0e360e01b6020850152602484016139d1565b939015613d835750505050565b7fb6847a3240c9f4a4bedda5dac3ad17fe3eed74aec7c32aac50b131e7c893bd9b93613db682613aeb93613adf96612093565b9490613ad1604051968792638a91b0e360e01b6020850152602484016139d1565b85613df4613de76132cb84613031565b6001600160e01b03191690565b14613e0157600101613d35565b90613e279293949550613e216132cb613e1c6132de93613107565b613031565b91613031565b613e2f61317e565b9082915f80613d3d565b91909160408184031261024a578035613e518161032b565b92602082013567ffffffffffffffff811161024a57612191920161230c565b90613e86906001600160a01b0393810190613e39565b92166001600160a01b0382168015801561402e575b614012576001600160a01b0382165f525f51602061670c5f395f51905f526020526001600160a01b0360405f20541603613ff657613f4190613f26613f0161108b855f51602061670c5f395f51905f52906001600160a01b03165f5260205260405f2090565b915f51602061670c5f395f51905f52906001600160a01b03165f5260205260405f2090565b906001600160a01b03166001600160a01b0319825416179055565b613f7c613f6c825f51602061670c5f395f51905f52906001600160a01b03165f5260205260405f2090565b6001600160a01b03198154169055565b613fa25a60405190638a91b0e360e01b6020830152613a7582613a678760248301612657565b919015613fae57505050565b6129b1613ad192613adf7fb6847a3240c9f4a4bedda5dac3ad17fe3eed74aec7c32aac50b131e7c893bd9b95604051958691638a91b0e360e01b602084015260248301612657565b637c84ecfb60e01b5f526001600160a01b03821660045260245ffd5b6001600160a01b0382637c84ecfb60e01b5f521660045260245ffd5b5060018114613e9b565b9061404e906001600160a01b0393810190613e39565b92166001600160a01b03821680158015614119575b614012576001600160a01b0382165f525f5160206166ac5f395f51905f526020526001600160a01b0360405f20541603613ff6576140ee90613f266140c961108b855f5160206166ac5f395f51905f52906001600160a01b03165f5260205260405f2090565b915f5160206166ac5f395f51905f52906001600160a01b03165f5260205260405f2090565b613f7c613f6c825f5160206166ac5f395f51905f52906001600160a01b03165f5260205260405f2090565b5060018114614063565b61412e610a17614cc4565b80614247575b61413a57565b60015f525f5160206166ac5f395f51905f526020526141787f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf1761108b565b6001600160a01b0381168015158061423c575b1561422b5760405163d60b347f60e01b815230600482015290602090829060249082905afa908115610598575f9161420d575b506141d1576141cc90614399565b614178565b6001600160a01b036001915b16146141e557565b7fcc319d84000000000000000000000000000000000000000000000000000000005f5260045ffd5b614225915060203d811161259e57612590818361215a565b5f6141be565b506001600160a01b036001916141dd565b50600181141561418b565b5060405163d60b347f60e01b81523060048201526020816024817f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03165afa908115610598575f916142a2575b5015614134565b6142bb915060203d60201161259e57612590818361215a565b5f61429b565b6142f1936001600160a01b0360209496939660405196879586948593637aa8f17760e11b855233600486016134a7565b0392165afa908115610598575f9161437a575b507f77390000000000000000000000000000000000000000000000000000000000007fffff0000000000000000000000000000000000000000000000000000000000008216148061435d575b614358575090565b905090565b506001600160e01b031982166001600160e01b0319821611614350565b614393915060203d60201161227657612267818361215a565b5f614304565b6001600160a01b031680156143cc575f525f5160206166ac5f395f51905f526020526001600160a01b0360405f20541690565b637c84ecfb60e01b5f5260045260245ffd5b6001600160a01b0316806001141590816143f6575090565b90505f525f5160206166ac5f395f51905f526020526001600160a01b0360405f205416151590565b6001600160a01b031680600114159081614436575090565b90505f525f51602061670c5f395f51905f526020526001600160a01b0360405f205416151590565b67ffffffffffffffff81116121555760051b60200190565b60408051909190614487838261215a565b6001815291601f1901825f5b82811061449f57505050565b806060602080938501015201614493565b906144ba8261445e565b6144c7604051918261215a565b82815280926144d8601f199161445e565b01905f5b8281106144e857505050565b8060606020809385010152016144dc565b8051156130895760200190565b80518210156130895760209160051b010190565b91612191939161453291604085526040850191612611565b916020818403910152611236565b9061454a91615e49565b916001600160f81b031981166145c75750614564826144b0565b915f5b8181106145745750505090565b806145ab6145856001938587615ec9565b80356145908161032b565b6145a36020830135926040810190612407565b929091615ff5565b6145b58287614506565b526145c08186614506565b5001614567565b9291906001600160f81b03198416600160f81b036145ea57612191929350615eeb565b6001600160f81b0319846308c3ee0360e11b5f521660045260245ffd5b929161219194926001600160a01b03613a0893168552606060208601526060850191612611565b9061463b91939293615fa6565b91614647959395614476565b956001600160f81b03198516614677576146619450615ff5565b61466a836144f9565b52614674826144f9565b50565b919293600160f81b6001600160f81b03198216145f14612d3e5750838361469e9284615fce565b6146a7876144f9565b52156146b257505050565b6129b17f4b44f876ced2ce5c5dc854622334777a5e68b7307b90aa55cd9e566b24918c38936146e0876144f9565b519060405194859485614607565b906146f891615e49565b90916001600160f81b0319811661475557505f5b81811061471857505050565b8061474f6147296001938587615ec9565b80356147348161032b565b6147476020830135926040810190612407565b929091616022565b0161470c565b92916001600160f81b03198416600160f81b036145ea57614674929350615eeb565b6001600160f81b03199161478a91615fa6565b93909294169384155f146147a2576103479450616022565b919293600160f81b81145f146147fe575083836147bf9284615fce565b9390156147cc5750505050565b7f4b44f876ced2ce5c5dc854622334777a5e68b7307b90aa55cd9e566b24918c3893613aeb9160405194859485614607565b6308c3ee0360e11b5f5260045260245ffd5b6008810361484757506001600160a01b037f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c09541690565b6009810361487e57506001600160a01b037f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c08541690565b7ff6424610000000000000000000000000000000000000000000000000000000005f5260045260245ffd5b6001600160a01b036148ed81926001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b541691161490565b9392614903919336916122d6565b6020815191012090604051926001600160a01b0360208501957ff6c866c1cd985ce61f030431e576c0e82887de0643dfa8a2e6efc3463e638ed087521660408501526060840152608083015260a082015260a0815261496360c08261215a565b51902090565b92602092916001600160a01b036149826149a09661606b565b60405196879586948593637aa8f17760e11b855230600486016134a7565b0392165afa5f91816149cd575b506149b757505f90565b6001600160e01b031916630b135d3f60e11b1490565b6149e791925060203d60201161227657612267818361215a565b905f6149ad565b6001600160a01b031680156146745760407f341347516a9de374859dfda710fa4828b2d48cb57d4fbe4c1149612b8e02276e91614a2b600861627e565b815190600882526020820152a1565b6001600160a01b031680156146745760407f341347516a9de374859dfda710fa4828b2d48cb57d4fbe4c1149612b8e02276e91614a77600961627e565b815190600982526020820152a1565b5f5160206166ec5f395f51905f52545f5f5160206166ec5f395f51905f525580614aad5750565b5f5160206166ec5f395f51905f525f5260070160031c7f83f9b619edc9f43576821d856bc19cf4dff9f52048e1eda1b7c8f88ea11af5ea908101905b818110614af4575050565b5f8155600101614ae9565b5f51602061668c5f395f51905f52545f5b818110614b925750505f51602061668c5f395f51905f52545f5f51602061668c5f395f51905f525580614b405750565b5f51602061668c5f395f51905f525f5260070160031c7f03091a1950aec911b7d69775d400f97274a68b1ca29a0c9bfcd94d200ed924b6908101905b818110614b87575050565b5f8155600101614b7c565b80614bb0614ba160019361308e565b90549060031b1c60e01b6131c1565b01614b10565b60015f525f51602061670c5f395f51905f526020527fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f5546001600160a01b0316614c9c5760015f525f51602061670c5f395f51905f52602052614c2960405f2060016001600160a01b0319825416179055565b60015f525f5160206166ac5f395f51905f526020526001600160a01b037f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf175416614c9c5760015f525f5160206166ac5f395f51905f5260205261034760405f2060016001600160a01b0319825416179055565b7f53c85e66000000000000000000000000000000000000000000000000000000005f5260045ffd5b5f906017303b14614cd157565b905060035f80303c5f5160e81c62ef01001490565b7fc473de86d0138e06e4d4918a106463a7cc005258d2e21915272bcb4594c18900545f5b81811015614d78577fc473de86d0138e06e4d4918a106463a7cc005258d2e21915272bcb4594c189005f525f5160206166ac5f395f51905f52817fdb3901c0862740f848a4aebebd6b3d645e6b3bc6adf2cf46e83a846b3a343933015414614d7457600101614d0a565b5050565b506801000000000000000081101561215557600181017fc473de86d0138e06e4d4918a106463a7cc005258d2e21915272bcb4594c18900557fc473de86d0138e06e4d4918a106463a7cc005258d2e21915272bcb4594c1890054811015613089577fc473de86d0138e06e4d4918a106463a7cc005258d2e21915272bcb4594c189005f527fdb3901c0862740f848a4aebebd6b3d645e6b3bc6adf2cf46e83a846b3a343933015f5160206166ac5f395f51905f529055565b92612191949192614e429136916122d6565b60208151910120604051926001600160a01b0360208501957fd3ddfc12654178cc44d4a7b6b969cfdce7ffe6342326ba37825314cffa0fba9c87521660408501526060840152608083015260a082015260a08152614ea160c08261215a565b51902061606b565b6001600160a01b0390939293614ebf5f9361627e565b1691823b1561024a57604051638a91b0e360e01b81525f8180614eec60206004830181815201868a612611565b038183885af19081614f3e575b50613a83577f55ee8ee9d8f2c5f3d998f93aa8be15e22a0d662c816d6390a6f79a9d88520d96936129b191604051948594508452604060208501526040840191612611565b614f4b9193505f9061215a565b5f915f614ef9565b6001600160a01b0361034791166001600160a01b03166001600160a01b03195f5160206166cc5f395f51905f525416175f5160206166cc5f395f51905f5255565b60405193926020929190614fa8848761215a565b5f86525f928380936020890196601f190136883760208451940192f1903d9081614fd7575b5f908286523e9190565b5f9150614fcd565b90614fe98261445e565b614ff6604051918261215a565b8281528092615007601f199161445e565b0190602036910137565b5f1981146120555760010190565b90821015613089576103b39160051b810190612407565b9150615041906163d2565b92939180840361512d575f5b81811061505c57505050505050565b8061506a60019284896137e3565b3582810361508e575061508861508182888761501f565b9087615c7f565b0161504d565b600281036150b157506150ac6150a582888761501f565b9087615b7f565b615088565b600381036150cf57506150ac6150c882888761501f565b90876154ab565b600481036150ed57506150ac6150e682888761501f565b908761533e565b85600882148015615123575b615105575b5050615088565b61511c91615114848a8961501f565b929091615155565b5f856150fe565b50600982146150f9565b7fb4fa3fb3000000000000000000000000000000000000000000000000000000005f5260045ffd5b9291906001600160a01b0361517e6001600160a01b035f5160206166cc5f395f51905f52541690565b168061518e57506103479361522e565b916040939193519363d68f602560e01b85525f85806151b236343360048501612631565b038183885af1948515610598575f9561520e575b506151d293949561522e565b803b1561024a576151fd5f92918392604051948580948193630b9dfbed60e11b835260048301612657565b03925af18015610598576136815750565b6151d2949550615227903d805f833e610c85818361215a565b94936151c6565b60405163ecd0596160e01b8152600481018290526001600160a01b03831694929190602081602481895afa908115610598575f9161531f575b50156152f75761527681614810565b6001600160a01b0381166152c357509061528f916162f2565b8061529957505050565b823b1561024a576151fd925f92836040518096819582946306d61fe760e41b8452600484016139d1565b7fc689cd97000000000000000000000000000000000000000000000000000000005f526001600160a01b031660045260245ffd5b7fe27c1dd8000000000000000000000000000000000000000000000000000000005f5260045ffd5b615338915060203d60201161259e57612590818361215a565b5f615267565b91906001600160a01b036153666001600160a01b035f5160206166cc5f395f51905f52541690565b1680615376575061034792615415565b90916040519263d68f602560e01b84525f848061539836343360048501612631565b038183875af1938415610598575f946153b8575b506151d2929394615415565b6151d29394506153d1903d805f833e610c85818361215a565b93926153ac565b156153e05750565b6001600160a01b03907f741cbe03000000000000000000000000000000000000000000000000000000005f521660045260245ffd5b60405163ecd0596160e01b81526004808201526001600160a01b038216939190602081602481885afa908115610598575f9161548c575b50156152f75761528f906154876154776001600160a01b035f5160206166cc5f395f51905f52541690565b6001600160a01b038116156153d8565b614f53565b6154a5915060203d60201161259e57612590818361215a565b5f61544c565b91906001600160a01b036154d36001600160a01b035f5160206166cc5f395f51905f52541690565b16806154e35750610347926155f0565b90916040519263d68f602560e01b84525f848061550536343360048501612631565b038183875af1938415610598575f94615525575b506151d29293946155f0565b6151d293945061553e903d805f833e610c85818361215a565b9392615519565b90600410156130895760040190565b1561555b57565b7f867a1dcf000000000000000000000000000000000000000000000000000000005f5260045ffd5b1561558a57565b7fc001660b000000000000000000000000000000000000000000000000000000005f5260045ffd5b156155ba5750565b6001600160e01b0319907fa56a04dd000000000000000000000000000000000000000000000000000000005f521660045260245ffd5b90916001600160a01b0382169160405163ecd0596160e01b81526020818061562060048201906003602083019252565b0381875afa908115610598575f91615b60575b50156152f7576157ff84916157c46156a66105b986806156846156776156698361566361338c6158049e8e612085565b9b615545565b356001600160f81b03191690565b6001600160f81b03191690565b9a6001600160f81b03198c16158015615b49575b6156a190615554565b6120b0565b966157846001600160e01b031986166306d61fe760e41b8114908115615b38575b8115615b27575b8115615b16575b8115615b05575b8115615af4575b8115615ae3575b8115615ad2575b8115615ac1575b8115615ab0575b8115615a9f575b8115615a8e575b8115615a64575b8115615a3a575b8115615a10575b81156159e6575b81156159bc575b8115615992575b8115615981575b8115615970575b8115615946575b811561591c575b81156158f2575b81156158c8575b811561589e575b811561588d575b8115615863575b8115615839575b5015615583565b61579985615794610a178261642d565b6155b2565b6157b36157a46122ab565b6001600160a01b039094168452565b6001600160f81b0319166020830152565b6108ad836001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b613b2d565b815161580e575050565b803b1561024a576151fd5f929183926040519485809481936306d61fe760e41b835260048301612657565b7f112d3a7d000000000000000000000000000000000000000000000000000000009150145f61577d565b7fa71763a80000000000000000000000000000000000000000000000000000000081149150615776565b639517e29f60e01b8114915061576f565b7fd691c9640000000000000000000000000000000000000000000000000000000081149150615768565b7fe9ae5c530000000000000000000000000000000000000000000000000000000081149150615761565b7f9cfd7cff000000000000000000000000000000000000000000000000000000008114915061575a565b7fd03c79140000000000000000000000000000000000000000000000000000000081149150615753565b7ff2dc691d000000000000000000000000000000000000000000000000000000008114915061574c565b634b6a141960e01b81149150615745565b630b135d3f60e11b8114915061573e565b7f8dd7712f0000000000000000000000000000000000000000000000000000000081149150615737565b7fb760faf90000000000000000000000000000000000000000000000000000000081149150615730565b7f52b7512c0000000000000000000000000000000000000000000000000000000081149150615729565b7f19822f7c0000000000000000000000000000000000000000000000000000000081149150615722565b7f570e1a36000000000000000000000000000000000000000000000000000000008114915061571b565b7fee2194230000000000000000000000000000000000000000000000000000000081149150615714565b637aa8f17760e11b8114915061570d565b639700320360e01b81149150615706565b630b9dfbed60e11b811491506156ff565b63d68f602560e01b811491506156f8565b637aa8f17760e11b811491506156f1565b639700320360e01b811491506156ea565b63e24f8f9360e01b811491506156e3565b637a0468b760e01b811491506156dc565b63d60b347f60e01b811491506156d5565b63ecd0596160e01b811491506156ce565b638a91b0e360e01b811491506156c7565b50607f60f91b6001600160f81b03198d1614615698565b615b79915060203d60201161259e57612590818361215a565b5f615633565b91906001600160a01b03615ba76001600160a01b035f5160206166cc5f395f51905f52541690565b1680615bb7575061034792615c19565b90916040519263d68f602560e01b84525f8480615bd936343360048501612631565b038183875af1938415610598575f94615bf9575b506151d2929394615c19565b6151d2939450615c12903d805f833e610c85818361215a565b9392615bed565b60405163ecd0596160e01b8152600260048201526001600160a01b038216939190602081602481885afa908115610598575f91615c60575b50156152f75761528f90616477565b615c79915060203d60201161259e57612590818361215a565b5f615c51565b91906001600160a01b03615ca76001600160a01b035f5160206166cc5f395f51905f52541690565b1680615cb7575061034792615d19565b90916040519263d68f602560e01b84525f8480615cd936343360048501612631565b038183875af1938415610598575f94615cf9575b506151d2929394615d19565b6151d2939450615d12903d805f833e610c85818361215a565b9392615ced565b60405163ecd0596160e01b8152600160048201526001600160a01b038216939190602081602481885afa908115610598575f91615db8575b50156152f7576001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000168414615d905761528f9061659b565b7fabc3af79000000000000000000000000000000000000000000000000000000005f5260045ffd5b615dd1915060203d60201161259e57612590818361215a565b5f615d51565b918160141161024a57823560601c92601401916013190190565b5f9192806040519485378338925af4913d82523d5f602084013e60203d830101604052565b5f919392806040519586378438925af415615e40573d82523d5f602084013e60203d830101604052565b503d5f823e3d90fd5b909181359182810193601f199101016020840193803593828560051b8301119060401c17615ebc5783615e7a575050565b835b5f190160208160051b8301013580830160608101908135809101918680602080860135809601011191111792171760401c17615ebc5780615e7c57505050565b63ba597e7e5f526004601cfd5b91908110156130895760051b81013590605e198136030182121561024a570190565b919091615ef7836144b0565b925f5b818110615f0657505050565b80615f146001928486615ec9565b8035615f1f8161032b565b6040820190615f3d6020840135615f368486612407565b9184615fce565b615f47868c614506565b5215615f57575b50505001615efa565b615f8e615f9b927f4b44f876ced2ce5c5dc854622334777a5e68b7307b90aa55cd9e566b24918c3894615f898461032b565b612407565b6146e0868c959395614506565b0390a15f8080615f4e565b908060141161024a57813560601c926034821061024a57601483013592603401916033190190565b905f928491604051958692833738935af1913d82523d5f602084013e60203d830101604052565b90925f92819594604051968792833738935af115615e40573d82523d5f602084013e60203d830101604052565b8380935f93604051958692833738935af1156127965701604052565b60405190602036830101604052816014360181525f602036920137604051601481016040523360601b9052565b7f00000000000000000000000000000000000000000000000000000000000000007f000000000000000000000000000000000000000000000000000000000000000030147f0000000000000000000000000000000000000000000000000000000000000000461416156160f6575b6719010000000000005f52601a52603a526042601820905f603a52565b5060a06040517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f81527f000000000000000000000000000000000000000000000000000000000000000060208201527f00000000000000000000000000000000000000000000000000000000000000006040820152466060820152306080820152206160d9565b60015f525f5160206166ac5f395f51905f5260208190527f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf17546001600160a01b03165b6001600160a01b038116908115612d08575f91825260208390526040808320546001600160a01b039283168452922080546001600160a01b0319169055166161c0565b60015f525f51602061670c5f395f51905f5260208190527fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f5546001600160a01b0316808015612d08575f91825260208390526040808320546001600160a01b039283168452922080546001600160a01b0319169055166161c0565b600881036162b857507f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0980546001600160a01b0319169055565b6009810361487e57507f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0880546001600160a01b0319169055565b6008810361636257506001600160a01b0361034791166001600160a01b03166001600160a01b03197f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c095416177f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0955565b6009810361487e57506001600160a01b0361034791166001600160a01b03166001600160a01b03197f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c085416177f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0855565b602081019136831161024a5781358201916020830136811161024a5793833593602036918660051b01011161024a5736604083011161024a5735016020810136811161024a5791813591602036918460051b01011161024a57565b6164706001600160a01b03916001600160e01b0319165f527f9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c0260205260405f2090565b5416151590565b6001600160a01b03811680158015616591575b6143cc575f9081525f51602061670c5f395f51905f5260205260409020546001600160a01b031661655d5760015f525f51602061670c5f395f51905f52602052610347906165226164fa7fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f561108b565b613f26835f51602061670c5f395f51905f52906001600160a01b03165f5260205260405f2090565b60015f525f51602061670c5f395f51905f526020527fea7b7a702bfdbb752f6ea9baf36f52e2d0036c56b8cb9e1bd5f570a0e63be7f5613f26565b7f40d3d1a4000000000000000000000000000000000000000000000000000000005f526001600160a01b031660045260245ffd5b506001811461648a565b6001600160a01b03811680158015616681575b6143cc575f9081525f5160206166ac5f395f51905f5260205260409020546001600160a01b031661655d5760015f525f5160206166ac5f395f51905f526020526103479061664661661e7f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf1761108b565b613f26835f5160206166ac5f395f51905f52906001600160a01b03165f5260205260405f2090565b60015f525f5160206166ac5f395f51905f526020527f996a594045e3ca684f704b1cf5a45553b38f5c17dfaeb834fd728d4924f4bf17613f26565b50600181146165ae56fe9195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c059195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c009195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c069195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c039195d48440658ac27f13a7bd256a2e74da1f2416f468d66228b37e6ac4790c01';

    // Load environment variables
    address defaultECDSAValidator = vm.envAddress('DEFAULT_ECDSA_VALIDATOR');
    bytes memory initData = abi.encodePacked(eEeEeAddress);

    bytes memory constructorArgs = abi.encode(entryPoint, defaultECDSAValidator, initData);

    // Concatenate bytecode + constructor arguments
    bytes memory finalBytecode = abi.encodePacked(deployedBytecode, constructorArgs);

    // Deploy contract if needed
    deployGeneric(deployerPrivateKey, saltString, finalBytecode, contractName);
  }

  function deployGeneric(
    uint256 deployerPrivateKey,
    string memory saltString,
    bytes memory finalBytecode,
    string memory contractName
  ) public {
    // Compute derived salt
    bytes32 derivedSalt = keccak256(abi.encodePacked(saltString));

    // Compute contract address before deployment
    address computedAddress = deployerInstance.addressOf(derivedSalt);

    console.log(string(abi.encodePacked(contractName, ' Computed Address:')), computedAddress);

    // Check if contract is already deployed
    uint256 codeSize;
    assembly {
      codeSize := extcodesize(computedAddress)
    }

    if (codeSize == 0) {
      console.log(string(abi.encodePacked(contractName, ' not deployed, deploying now...')));
      deployContract(deployerPrivateKey, derivedSalt, finalBytecode, contractName, computedAddress);
    } else {
      console.log(string(abi.encodePacked(contractName, ' already deployed at:')), computedAddress);
    }
  }

  function deployContract(
    uint256 deployerPrivateKey,
    bytes32 derivedSalt,
    bytes memory finalBytecode,
    string memory contractName,
    address computedAddress
  ) internal {
    uint256 chainId = block.chainid;

    uint256 gasPrice = DEPLOYMENT_CHAIN_GAS_PRICES[chainId];
    require(gasPrice > 0, NoGasPriceSet());

    console.log('Using gas price:', gasPrice);

    // Deploy contract using deployer's private key
    vm.startBroadcast(deployerPrivateKey);
    (bool success,) = address(deployerInstance).call{gas: 5_000_000}(
      abi.encodeWithSignature('deploy(bytes32,bytes)', derivedSalt, finalBytecode)
    );
    vm.stopBroadcast();

    require(success, ContractDeploymentFailed());

    console.log(string(abi.encodePacked('Transaction success: ', contractName)));

    // Verify deployment by checking contract existence
    uint256 codeSize;
    assembly {
      codeSize := extcodesize(computedAddress)
    }

    if (codeSize == 0) {
      console.log(string(abi.encodePacked('Invalid deployment of ', contractName)));
    } else {
      console.log(string(abi.encodePacked(contractName, ' Deployed Successfully at:')), computedAddress);
    }
  }
}
